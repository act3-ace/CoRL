
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="The following python project creates a python interface for training Deep RL - provides the base RL functionality and APIs to enable rapid ablation testing and setup. The Core Reinforcement Learning library is intended to enable scalable deep reinforcement learning experimentation in a manner extensible to new simulations and new ways for the learning agents to interact with them. The hope is that this makes RL research easier by removing lock-in to particular simulations.">
      
      
        <meta name="author" content="ACT3">
      
      
        <link rel="canonical" href="https://act3-ace.github.io/CoRL/reference/environment/multi_agent_env/">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.5.3">
    
    
      
        <title>Multi agent env - ACT3 RL Core - CoRL</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7a952b86.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../css/style.css">
    
      <link rel="stylesheet" href="../../../css/material.css">
    
      <link rel="stylesheet" href="../../../css/mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="lime">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#corl.environment.multi_agent_env" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="ACT3 RL Core - CoRL" class="md-header__button md-logo" aria-label="ACT3 RL Core - CoRL" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4.41 3 3 4.41 5.69 7.1A7.924 7.924 0 0 0 4 12c0 1.85.63 3.55 1.69 4.9L3 19.59 4.41 21l2.69-2.69A7.924 7.924 0 0 0 12 20c1.85 0 3.55-.63 4.9-1.69L19.59 21 21 19.59l-2.69-2.69A7.924 7.924 0 0 0 20 12c0-1.85-.63-3.55-1.69-4.9L21 4.41 19.59 3 16.9 5.69A7.924 7.924 0 0 0 12 4c-1.85 0-3.55.63-4.9 1.69L4.41 3M12 6c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6 2.69-6 6-6Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ACT3 RL Core - CoRL
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Multi agent env
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/act3-ace/CoRL" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    CoRL
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../.." class="md-tabs__link">
      Introduction
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../concepts/" class="md-tabs__link">
      Concepts
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../configuration/" class="md-tabs__link">
      Configuration
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../install/" class="md-tabs__link">
      Install
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../license/" class="md-tabs__link">
      License
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../tasks/docking_1d/" class="md-tabs__link">
        Tasks
      </a>
    </li>
  

      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="../../SUMMARY/" class="md-tabs__link md-tabs__link--active">
      ACT3 CORE
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../change_log/" class="md-tabs__link">
      Change log
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="ACT3 RL Core - CoRL" class="md-nav__button md-logo" aria-label="ACT3 RL Core - CoRL" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4.41 3 3 4.41 5.69 7.1A7.924 7.924 0 0 0 4 12c0 1.85.63 3.55 1.69 4.9L3 19.59 4.41 21l2.69-2.69A7.924 7.924 0 0 0 12 20c1.85 0 3.55-.63 4.9-1.69L19.59 21 21 19.59l-2.69-2.69A7.924 7.924 0 0 0 20 12c0-1.85-.63-3.55-1.69-4.9L21 4.41 19.59 3 16.9 5.69A7.924 7.924 0 0 0 12 4c-1.85 0-3.55.63-4.9 1.69L4.41 3M12 6c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6 2.69-6 6-6Z"/></svg>

    </a>
    ACT3 RL Core - CoRL
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/act3-ace/CoRL" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    CoRL
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../concepts/">Concepts</a>
          
            <label for="__nav_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Concepts" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Concepts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../diverse-frame-rate/" class="md-nav__link">
        Diverse frame rate
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../configuration/" class="md-nav__link">
        Configuration
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../install/" class="md-nav__link">
        Install
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../license/" class="md-nav__link">
        License
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Tasks
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tasks" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Tasks
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tasks/docking_1d/" class="md-nav__link">
        Docking 1D
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" checked>
      
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../SUMMARY/">ACT3 CORE</a>
          
            <label for="__nav_7">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="ACT3 CORE" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          ACT3 CORE
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../__init__/" class="md-nav__link">
          init  
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../train_rl/" class="md-nav__link">
        Train rl
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_3" type="checkbox" id="__nav_7_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_3">
          Evaluation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Evaluation" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_3">
          <span class="md-nav__icon md-icon"></span>
          Evaluation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/__init__.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/cli_generate_metrics.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/cli_visualize.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/default_config_updates.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/episode_artifact.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/eval_logger_name.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/evaluation_outcome.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/scene_processors.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/serialize_platforms.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_3_10" type="checkbox" id="__nav_7_3_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_3_10">
          Launchers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Launchers" data-md-level="3">
        <label class="md-nav__title" for="__nav_7_3_10">
          <span class="md-nav__icon md-icon"></span>
          Launchers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/launchers/__init__.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/launchers/evaluate_from_config.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_3_11" type="checkbox" id="__nav_7_3_11" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_3_11">
          Loaders
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Loaders" data-md-level="3">
        <label class="md-nav__title" for="__nav_7_3_11">
          <span class="md-nav__icon md-icon"></span>
          Loaders
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/loader/__init__.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/loader/check_point_file.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/loader/heuristic.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/loader/i_agent_loader.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/loader/weight_file.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_3_12" type="checkbox" id="__nav_7_3_12" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_3_12">
          Metrics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Metrics" data-md-level="3">
        <label class="md-nav__title" for="__nav_7_3_12">
          <span class="md-nav__icon md-icon"></span>
          Metrics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/__init__.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/alerts.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/generator.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/metric.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/processors.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/scenario_alert_generators.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/scenario_metric_generators.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/scopes.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_3_12_9" type="checkbox" id="__nav_7_3_12_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_3_12_9">
          Aggregators
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Aggregators" data-md-level="4">
        <label class="md-nav__title" for="__nav_7_3_12_9">
          <span class="md-nav__icon md-icon"></span>
          Aggregators
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/aggregators/__init__.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/aggregators/accumulate.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/aggregators/average.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/aggregators/criteria_rate.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/aggregators/sum.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_3_12_10" type="checkbox" id="__nav_7_3_12_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_3_12_10">
          Generators
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Generators" data-md-level="4">
        <label class="md-nav__title" for="__nav_7_3_12_10">
          <span class="md-nav__icon md-icon"></span>
          Generators
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/generators/__init__.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/generators/dones.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/generators/rewards.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/generators/meta/__init__.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/generators/meta/episode_length.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/generators/meta/runtime.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_3_12_11" type="checkbox" id="__nav_7_3_12_11" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_3_12_11">
          Types
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Types" data-md-level="4">
        <label class="md-nav__title" for="__nav_7_3_12_11">
          <span class="md-nav__icon md-icon"></span>
          Types
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/types/__init__.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/types/nonterminals/__init__.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/types/nonterminals/dict.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/types/nonterminals/timed_value.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/types/nonterminals/vector.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/types/terminals/__init__.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/types/terminals/discrete.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/types/terminals/rate.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/types/terminals/real.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/types/terminals/string.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/metrics/types/terminals/void.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_3_12_12" type="checkbox" id="__nav_7_3_12_12" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_3_12_12">
          Recording
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Recording" data-md-level="4">
        <label class="md-nav__title" for="__nav_7_3_12_12">
          <span class="md-nav__icon md-icon"></span>
          Recording
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/recording/__init__.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/recording/folder.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/recording/i_recorder.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_3_12_13" type="checkbox" id="__nav_7_3_12_13" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_3_12_13">
          Runners
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Runners" data-md-level="4">
        <label class="md-nav__title" for="__nav_7_3_12_13">
          <span class="md-nav__icon md-icon"></span>
          Runners
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/runners/__init__.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/runners/iterate_test_cases.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/runners/section_factories/__init__.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/runners/section_factories/task.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/runners/section_factories/teams.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/runners/section_factories/engine/__init__.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/runners/section_factories/engine/rllib/__init__.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/runners/section_factories/engine/rllib/default_evaluation_callbacks.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/runners/section_factories/engine/rllib/eval_config_updates.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/runners/section_factories/engine/rllib/rllib_trainer.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/runners/section_factories/plugins/__init__.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/runners/section_factories/plugins/config_updater.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/runners/section_factories/plugins/platform_serializer.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/runners/section_factories/plugins/plugins.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/runners/section_factories/test_cases/__init__.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/runners/section_factories/test_cases/config_parser.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/runners/section_factories/test_cases/pandas.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/runners/section_factories/test_cases/test_case_generator.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_3_12_14" type="checkbox" id="__nav_7_3_12_14" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_3_12_14">
          Util
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Util" data-md-level="4">
        <label class="md-nav__title" for="__nav_7_3_12_14">
          <span class="md-nav__icon md-icon"></span>
          Util
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/util/__init__.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/util/condition.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_3_12_15" type="checkbox" id="__nav_7_3_12_15" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_3_12_15">
          Visualization
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Visualization" data-md-level="4">
        <label class="md-nav__title" for="__nav_7_3_12_15">
          <span class="md-nav__icon md-icon"></span>
          Visualization
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/visualization/__init__.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/visualization/print.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/visualization/visualization.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_4" type="checkbox" id="__nav_7_4" >
      
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../agents/__init__/">Agents</a>
          
            <label for="__nav_7_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Agents" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_4">
          <span class="md-nav__icon md-icon"></span>
          Agents
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/base_agent/" class="md-nav__link">
        Base agent
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/noop_agent.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/random_action_agent.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_5" type="checkbox" id="__nav_7_5" >
      
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../dones/__init__/">Dones</a>
          
            <label for="__nav_7_5">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Dones" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_5">
          <span class="md-nav__icon md-icon"></span>
          Dones
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../dones/done_func_base/" class="md-nav__link">
        Done func base
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../dones/done_func_multi_wrapper/" class="md-nav__link">
        Done func multi wrapper
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../dones/done_func_wrapper/" class="md-nav__link">
        Done func wrapper
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../dones/episode_length_done/" class="md-nav__link">
        Episode length done
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../dones/openai_gym_done/" class="md-nav__link">
        Openai gym done
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../dones/sensor_bounds_check_done/" class="md-nav__link">
        Sensor bounds check done
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../dones/done_func_dict_wrapper/" class="md-nav__link">
        Done func dict wrapper
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_5_8" type="checkbox" id="__nav_7_5_8" >
      
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../dones/docking_1d/__init__/">Docking 1D</a>
          
            <label for="__nav_7_5_8">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Docking 1D" data-md-level="3">
        <label class="md-nav__title" for="__nav_7_5_8">
          <span class="md-nav__icon md-icon"></span>
          Docking 1D
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../dones/docking_1d/dones/" class="md-nav__link">
        Dones
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_6" type="checkbox" id="__nav_7_6" >
      
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../models/__init__/">Models</a>
          
            <label for="__nav_7_6">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Models" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_6">
          <span class="md-nav__icon md-icon"></span>
          Models
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/frame_stacking/" class="md-nav__link">
        Frame stacking
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/torch_frame_stack/" class="md-nav__link">
        Torch frame stack
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_7" type="checkbox" id="__nav_7_7" checked>
      
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../__init__/">Environment</a>
          
            <label for="__nav_7_7">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Environment" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_7">
          <span class="md-nav__icon md-icon"></span>
          Environment
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../default_env_rllib_callbacks/" class="md-nav__link">
        Default env rllib callbacks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../gym_env/" class="md-nav__link">
        Gym env
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Multi agent env
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Multi agent env
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env" class="md-nav__link">
    corl.environment.multi_agent_env
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv" class="md-nav__link">
    ACT3MultiAgentEnv
  </a>
  
    <nav class="md-nav" aria-label="ACT3MultiAgentEnv">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.action_space" class="md-nav__link">
    action_space
  </a>
  
    <nav class="md-nav" aria-label="action_space">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.action_space--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.done_info" class="md-nav__link">
    done_info
  </a>
  
    <nav class="md-nav" aria-label="done_info">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.done_info--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.episode_id" class="md-nav__link">
    episode_id
  </a>
  
    <nav class="md-nav" aria-label="episode_id">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.episode_id--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.get_validator" class="md-nav__link">
    get_validator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.glue_info" class="md-nav__link">
    glue_info
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.observation" class="md-nav__link">
    observation
  </a>
  
    <nav class="md-nav" aria-label="observation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.observation--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.observation_space" class="md-nav__link">
    observation_space
  </a>
  
    <nav class="md-nav" aria-label="observation_space">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.observation_space--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.reward_info" class="md-nav__link">
    reward_info
  </a>
  
    <nav class="md-nav" aria-label="reward_info">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.reward_info--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.simulator" class="md-nav__link">
    simulator
  </a>
  
    <nav class="md-nav" aria-label="simulator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.simulator--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.state" class="md-nav__link">
    state
  </a>
  
    <nav class="md-nav" aria-label="state">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.state--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.__init__" class="md-nav__link">
    __init__()
  </a>
  
    <nav class="md-nav" aria-label="__init__()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.__init__--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.create_training_observations" class="md-nav__link">
    create_training_observations()
  </a>
  
    <nav class="md-nav" aria-label="create_training_observations()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.create_training_observations--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.create_training_observations--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.post_process_trajectory" class="md-nav__link">
    post_process_trajectory()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.reset" class="md-nav__link">
    reset()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.seed" class="md-nav__link">
    seed()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.set_default_done_reward" class="md-nav__link">
    set_default_done_reward()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.step" class="md-nav__link">
    step()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvEppParameters" class="md-nav__link">
    ACT3MultiAgentEnvEppParameters
  </a>
  
    <nav class="md-nav" aria-label="ACT3MultiAgentEnvEppParameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvEppParameters.validate_leaves_are_parameters" class="md-nav__link">
    validate_leaves_are_parameters()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator" class="md-nav__link">
    ACT3MultiAgentEnvValidator
  </a>
  
    <nav class="md-nav" aria-label="ACT3MultiAgentEnvValidator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.epp" class="md-nav__link">
    epp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.Config" class="md-nav__link">
    Config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.add_plugin_paths" class="md-nav__link">
    add_plugin_paths()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.agents_match" class="md-nav__link">
    agents_match()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.agents_not_empty" class="md-nav__link">
    agents_not_empty()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.build_episode_parameter_provider_parameters" class="md-nav__link">
    build_episode_parameter_provider_parameters()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.construct_epp_registry_if_necessary_and_validate" class="md-nav__link">
    construct_epp_registry_if_necessary_and_validate()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.create_output_path" class="md-nav__link">
    create_output_path()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.get_seed" class="md-nav__link">
    get_seed()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.resolve_platforms" class="md-nav__link">
    resolve_platforms()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.resolve_reference_store_factory" class="md-nav__link">
    resolve_reference_store_factory()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.resolve_simulator_plugin" class="md-nav__link">
    resolve_simulator_plugin()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.update_units_and_parameters" class="md-nav__link">
    update_units_and_parameters()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.EnvironmentDoneValidator" class="md-nav__link">
    EnvironmentDoneValidator
  </a>
  
    <nav class="md-nav" aria-label="EnvironmentDoneValidator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.EnvironmentDoneValidator.check_done" class="md-nav__link">
    check_done()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.EnvironmentDoneValidator.check_shared" class="md-nav__link">
    check_shared()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.EnvironmentDoneValidator.check_task" class="md-nav__link">
    check_task()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.EnvironmentDoneValidator.check_world" class="md-nav__link">
    check_world()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/__init__/" class="md-nav__link">
          init  
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/env_creation/" class="md-nav__link">
        Env creation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/obs_buffer/" class="md-nav__link">
        Obs buffer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/space_sort/" class="md-nav__link">
        Space sort
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_8" type="checkbox" id="__nav_7_8" >
      
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../episode_parameter_providers/__init__/">Episode Parameter Provider</a>
          
            <label for="__nav_7_8">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Episode Parameter Provider" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_8">
          <span class="md-nav__icon md-icon"></span>
          Episode Parameter Provider
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../episode_parameter_providers/adr.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../episode_parameter_providers/core/" class="md-nav__link">
        Core
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../episode_parameter_providers/remote/" class="md-nav__link">
        Remote
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../episode_parameter_providers/simple/" class="md-nav__link">
        Simple
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../episode_parameter_providers/tabular_parameter_provider.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_9" type="checkbox" id="__nav_7_9" >
      
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../experiments/__init__/">Experiments</a>
          
            <label for="__nav_7_9">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Experiments" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_9">
          <span class="md-nav__icon md-icon"></span>
          Experiments
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../experiments/base_experiment/" class="md-nav__link">
        Base experiment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../experiments/rllib_experiment/" class="md-nav__link">
        Rllib experiment
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_10" type="checkbox" id="__nav_7_10" >
      
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../glues/__init__/">Glues</a>
          
            <label for="__nav_7_10">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Glues" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_10">
          <span class="md-nav__icon md-icon"></span>
          Glues
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../glues/base_glue/" class="md-nav__link">
        Base glue
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../glues/base_multi_wrapper/" class="md-nav__link">
        Base multi wrapper
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../glues/base_wrapper/" class="md-nav__link">
        Base wrapper
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../glues/base_dict_wrapper/" class="md-nav__link">
        Base dict wrapper
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_10_5" type="checkbox" id="__nav_7_10_5" >
      
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../glues/common/__init__/">Common</a>
          
            <label for="__nav_7_10_5">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Common" data-md-level="3">
        <label class="md-nav__title" for="__nav_7_10_5">
          <span class="md-nav__icon md-icon"></span>
          Common
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../glues/common/observe_part_validity/" class="md-nav__link">
        Observe part validity
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../glues/common/arithmetic_multi_glue/" class="md-nav__link">
        Arithmetic multi glue
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../glues/common/controller_glue/" class="md-nav__link">
        Controller glue
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../glues/common/observe_sensor/" class="md-nav__link">
        Observe sensor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../glues/common/observe_sensor_repeated/" class="md-nav__link">
        Observe sensor repeated
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../glues/common/target_value/" class="md-nav__link">
        Target value
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../glues/common/target_value_difference/" class="md-nav__link">
        Target value difference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../glues/common/projected_quantity/" class="md-nav__link">
        Projected quantity
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_10_6" type="checkbox" id="__nav_7_10_6" >
      
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../glues/controller_wrappers/__init__/">Controller Wrappers</a>
          
            <label for="__nav_7_10_6">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Controller Wrappers" data-md-level="3">
        <label class="md-nav__title" for="__nav_7_10_6">
          <span class="md-nav__icon md-icon"></span>
          Controller Wrappers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../glues/controller_wrappers/obs_relative_delta_controller_dict/" class="md-nav__link">
        Obs relative delta controller dict
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../glues/controller_wrappers/delta_controller/" class="md-nav__link">
        Delta controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../glues/controller_wrappers/obs_relative_delta_controller/" class="md-nav__link">
        Obs relative delta controller
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_11" type="checkbox" id="__nav_7_11" >
      
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../libraries/__init__/">Libraries</a>
          
            <label for="__nav_7_11">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Libraries" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_11">
          <span class="md-nav__icon md-icon"></span>
          Libraries
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../libraries/cleanup/" class="md-nav__link">
        Cleanup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../libraries/collection_utils/" class="md-nav__link">
        Collection utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../libraries/env_common/" class="md-nav__link">
        Env common
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../libraries/env_func_base/" class="md-nav__link">
        Env func base
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../libraries/env_space_util/" class="md-nav__link">
        Env space util
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../libraries/environment_dict/" class="md-nav__link">
        Environment dict
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../libraries/factory/" class="md-nav__link">
        Factory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../libraries/functor/" class="md-nav__link">
        Functor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../libraries/nan_check/" class="md-nav__link">
        Nan check
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../libraries/observation_extractor/" class="md-nav__link">
        Observation extractor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../libraries/observation_util/" class="md-nav__link">
        Observation util
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../libraries/parameters/" class="md-nav__link">
        Parameters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../libraries/plugin_library/" class="md-nav__link">
        Plugin library
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../libraries/property/" class="md-nav__link">
        Property
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../libraries/state_dict/" class="md-nav__link">
        State dict
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../libraries/units/" class="md-nav__link">
        Units
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../libraries/hparam_search_util/" class="md-nav__link">
        Hparam search util
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../libraries/rllib_setup_util/" class="md-nav__link">
        Rllib setup util
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_12" type="checkbox" id="__nav_7_12" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_12">
          Parts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Parts" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_12">
          <span class="md-nav__icon md-icon"></span>
          Parts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../parts/__init__.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../parts/memory_store.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_13" type="checkbox" id="__nav_7_13" >
      
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../parsers/__init__/">Parsers</a>
          
            <label for="__nav_7_13">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Parsers" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_13">
          <span class="md-nav__icon md-icon"></span>
          Parsers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../parsers/yaml_loader/" class="md-nav__link">
        Yaml loader
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_14" type="checkbox" id="__nav_7_14" >
      
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../policies/__init__/">Policies</a>
          
            <label for="__nav_7_14">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Policies" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_14">
          <span class="md-nav__icon md-icon"></span>
          Policies
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../policies/base_policy/" class="md-nav__link">
        Base policy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../policies/random_action/" class="md-nav__link">
        Random action
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../policies/scripted_action/" class="md-nav__link">
        Scripted action
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../policies/custom_policy/" class="md-nav__link">
        Custom policy
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_15" type="checkbox" id="__nav_7_15" >
      
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../rewards/__init__/">Rewards</a>
          
            <label for="__nav_7_15">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Rewards" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_15">
          <span class="md-nav__icon md-icon"></span>
          Rewards
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../rewards/base_measurement_operation/" class="md-nav__link">
        Base measurement operation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../rewards/episode_done/" class="md-nav__link">
        Episode done
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../rewards/exponential_decay_from_target_value/" class="md-nav__link">
        Exponential decay from target value
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../rewards/openai_gym_reward/" class="md-nav__link">
        Openai gym reward
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../rewards/reward_func_base/" class="md-nav__link">
        Reward func base
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../rewards/reward_func_multi_wrapper/" class="md-nav__link">
        Reward func multi wrapper
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../rewards/reward_func_wrapper/" class="md-nav__link">
        Reward func wrapper
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../rewards/multi_measurement_operation/" class="md-nav__link">
        Multi measurement operation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../rewards/reward_func_dict_wrapper/" class="md-nav__link">
        Reward func dict wrapper
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_15_10" type="checkbox" id="__nav_7_15_10" >
      
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../rewards/docking_1d/__init__/">Docking 1D</a>
          
            <label for="__nav_7_15_10">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Docking 1D" data-md-level="3">
        <label class="md-nav__title" for="__nav_7_15_10">
          <span class="md-nav__icon md-icon"></span>
          Docking 1D
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../rewards/docking_1d/docking_distance_change_reward/" class="md-nav__link">
        Docking distance change reward
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../rewards/docking_1d/docking_reward/" class="md-nav__link">
        Docking reward
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_16" type="checkbox" id="__nav_7_16" >
      
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../simulators/__init__/">Simulators</a>
          
            <label for="__nav_7_16">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Simulators" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_16">
          <span class="md-nav__icon md-icon"></span>
          Simulators
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../simulators/base_available_platforms/" class="md-nav__link">
        Base available platforms
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../simulators/base_parts/" class="md-nav__link">
        Base parts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../simulators/base_platform/" class="md-nav__link">
        Base platform
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../simulators/base_properties/" class="md-nav__link">
        Base properties
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../simulators/base_simulator/" class="md-nav__link">
        Base simulator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../simulators/common_platform_utils/" class="md-nav__link">
        Common platform utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_16_7" type="checkbox" id="__nav_7_16_7" >
      
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../simulators/openai_gym/__init__/">OpenAI Gym</a>
          
            <label for="__nav_7_16_7">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="OpenAI Gym" data-md-level="3">
        <label class="md-nav__title" for="__nav_7_16_7">
          <span class="md-nav__icon md-icon"></span>
          OpenAI Gym
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../simulators/openai_gym/gym_available_platforms/" class="md-nav__link">
        Gym available platforms
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../simulators/openai_gym/gym_controllers/" class="md-nav__link">
        Gym controllers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../simulators/openai_gym/gym_sensors/" class="md-nav__link">
        Gym sensors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../simulators/openai_gym/gym_simulator/" class="md-nav__link">
        Gym simulator
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_16_8" type="checkbox" id="__nav_7_16_8" >
      
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../simulators/six_dof/__init__/">Six DOF</a>
          
            <label for="__nav_7_16_8">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Six DOF" data-md-level="3">
        <label class="md-nav__title" for="__nav_7_16_8">
          <span class="md-nav__icon md-icon"></span>
          Six DOF
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../simulators/six_dof/base_six_dof_controllers/" class="md-nav__link">
        Base six dof controllers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../simulators/six_dof/base_six_dof_platform/" class="md-nav__link">
        Base six dof platform
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../simulators/six_dof/base_six_dof_properties/" class="md-nav__link">
        Base six dof properties
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_16_9" type="checkbox" id="__nav_7_16_9" >
      
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../simulators/docking_1d/__init__/">Docking 1D</a>
          
            <label for="__nav_7_16_9">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Docking 1D" data-md-level="3">
        <label class="md-nav__title" for="__nav_7_16_9">
          <span class="md-nav__icon md-icon"></span>
          Docking 1D
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../simulators/docking_1d/available_platforms/" class="md-nav__link">
        Available platforms
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../simulators/docking_1d/controllers/" class="md-nav__link">
        Controllers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../simulators/docking_1d/entities/" class="md-nav__link">
        Entities
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../simulators/docking_1d/platform/" class="md-nav__link">
        Platform
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../simulators/docking_1d/properties/" class="md-nav__link">
        Properties
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../simulators/docking_1d/sensors/" class="md-nav__link">
        Sensors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../simulators/docking_1d/simulator/" class="md-nav__link">
        Simulator
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../change_log/" class="md-nav__link">
        Change log
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env" class="md-nav__link">
    corl.environment.multi_agent_env
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv" class="md-nav__link">
    ACT3MultiAgentEnv
  </a>
  
    <nav class="md-nav" aria-label="ACT3MultiAgentEnv">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.action_space" class="md-nav__link">
    action_space
  </a>
  
    <nav class="md-nav" aria-label="action_space">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.action_space--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.done_info" class="md-nav__link">
    done_info
  </a>
  
    <nav class="md-nav" aria-label="done_info">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.done_info--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.episode_id" class="md-nav__link">
    episode_id
  </a>
  
    <nav class="md-nav" aria-label="episode_id">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.episode_id--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.get_validator" class="md-nav__link">
    get_validator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.glue_info" class="md-nav__link">
    glue_info
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.observation" class="md-nav__link">
    observation
  </a>
  
    <nav class="md-nav" aria-label="observation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.observation--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.observation_space" class="md-nav__link">
    observation_space
  </a>
  
    <nav class="md-nav" aria-label="observation_space">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.observation_space--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.reward_info" class="md-nav__link">
    reward_info
  </a>
  
    <nav class="md-nav" aria-label="reward_info">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.reward_info--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.simulator" class="md-nav__link">
    simulator
  </a>
  
    <nav class="md-nav" aria-label="simulator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.simulator--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.state" class="md-nav__link">
    state
  </a>
  
    <nav class="md-nav" aria-label="state">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.state--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.__init__" class="md-nav__link">
    __init__()
  </a>
  
    <nav class="md-nav" aria-label="__init__()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.__init__--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.create_training_observations" class="md-nav__link">
    create_training_observations()
  </a>
  
    <nav class="md-nav" aria-label="create_training_observations()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.create_training_observations--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.create_training_observations--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.post_process_trajectory" class="md-nav__link">
    post_process_trajectory()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.reset" class="md-nav__link">
    reset()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.seed" class="md-nav__link">
    seed()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.set_default_done_reward" class="md-nav__link">
    set_default_done_reward()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.step" class="md-nav__link">
    step()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvEppParameters" class="md-nav__link">
    ACT3MultiAgentEnvEppParameters
  </a>
  
    <nav class="md-nav" aria-label="ACT3MultiAgentEnvEppParameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvEppParameters.validate_leaves_are_parameters" class="md-nav__link">
    validate_leaves_are_parameters()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator" class="md-nav__link">
    ACT3MultiAgentEnvValidator
  </a>
  
    <nav class="md-nav" aria-label="ACT3MultiAgentEnvValidator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.epp" class="md-nav__link">
    epp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.Config" class="md-nav__link">
    Config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.add_plugin_paths" class="md-nav__link">
    add_plugin_paths()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.agents_match" class="md-nav__link">
    agents_match()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.agents_not_empty" class="md-nav__link">
    agents_not_empty()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.build_episode_parameter_provider_parameters" class="md-nav__link">
    build_episode_parameter_provider_parameters()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.construct_epp_registry_if_necessary_and_validate" class="md-nav__link">
    construct_epp_registry_if_necessary_and_validate()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.create_output_path" class="md-nav__link">
    create_output_path()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.get_seed" class="md-nav__link">
    get_seed()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.resolve_platforms" class="md-nav__link">
    resolve_platforms()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.resolve_reference_store_factory" class="md-nav__link">
    resolve_reference_store_factory()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.resolve_simulator_plugin" class="md-nav__link">
    resolve_simulator_plugin()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.update_units_and_parameters" class="md-nav__link">
    update_units_and_parameters()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.EnvironmentDoneValidator" class="md-nav__link">
    EnvironmentDoneValidator
  </a>
  
    <nav class="md-nav" aria-label="EnvironmentDoneValidator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.EnvironmentDoneValidator.check_done" class="md-nav__link">
    check_done()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.EnvironmentDoneValidator.check_shared" class="md-nav__link">
    check_shared()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.EnvironmentDoneValidator.check_task" class="md-nav__link">
    check_task()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corl.environment.multi_agent_env.EnvironmentDoneValidator.check_world" class="md-nav__link">
    check_world()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/act3-ace/CoRL/blob/main/docs/corl/environment/multi_agent_env.py" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


  <h1>Multi agent env</h1>

<div class="doc doc-object doc-module">

<a id="corl.environment.multi_agent_env"></a>
    <div class="doc doc-contents first">

      <hr />
<p>Air Force Research Laboratory (AFRL) Autonomous Capabilities Team (ACT3)
Reinforcement Learning (RL) Core.</p>
<p>This is a US Government Work not subject to copyright protection in the US.</p>
<p>The use, dissemination or disclosure of data in this file is subject to
limitation or restriction. See accompanying README and LICENSE for details.</p>
<hr />



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h2 id="corl.environment.multi_agent_env.ACT3MultiAgentEnv" class="doc doc-heading">
        <code>
ACT3MultiAgentEnv            (<span title="ray.rllib.env.multi_agent_env.MultiAgentEnv">MultiAgentEnv</span>)
        </code>



<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv" class="headerlink" title="Permanent link">¤</a></h2>

    <div class="doc doc-contents ">

      <p>ACT3MultiAgentEnv create a RLLIB MultiAgentEnv environment. The following class is intended to wrap
the interactions with RLLIB and the backend simulator environment. All items here are intended to be
common parts for running the RLLIB environment with ${simulator} being the unique interaction parts.</p>
<ol>
<li>Includes wrapping the creation of the simulator specific to run</li>
<li>Includes interactions with the dones, rewards, and glues</li>
<li>etc...</li>
</ol>

        <details class="quote">
          <summary>Source code in <code>corl/environment/multi_agent_env.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ACT3MultiAgentEnv</span><span class="p">(</span><span class="n">MultiAgentEnv</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ACT3MultiAgentEnv create a RLLIB MultiAgentEnv environment. The following class is intended to wrap</span>
<span class="sd">    the interactions with RLLIB and the backend simulator environment. All items here are intended to be</span>
<span class="sd">    common parts for running the RLLIB environment with ${simulator} being the unique interaction parts.</span>

<span class="sd">    1. Includes wrapping the creation of the simulator specific to run</span>
<span class="sd">    2. Includes interactions with the dones, rewards, and glues</span>
<span class="sd">    3. etc...</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">episode_parameter_provider_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;environment&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">EnvContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pylint: disable=too-many-statements, super-init-not-called</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        __init__ initializes the rllib multi agent environment</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        config : ray.rllib.env.env_context.EnvContext</span>
<span class="sd">            Passed in configuration for setting items up.</span>
<span class="sd">            Must have a &#39;simulator&#39; key whose value is a BaseIntegrator type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">config_vars</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">config_vars</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span> <span class="n">ACT3MultiAgentEnvValidator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_validator</span><span class="p">(</span><span class="o">**</span><span class="n">config</span><span class="p">,</span> <span class="o">**</span><span class="n">config_vars</span><span class="p">)</span>

        <span class="c1"># Random numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>

        <span class="c1"># setup default instance variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span> <span class="o">=</span> <span class="n">ObsBuffer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reward</span><span class="p">:</span> <span class="n">RewardDict</span> <span class="o">=</span> <span class="n">RewardDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_done</span><span class="p">:</span> <span class="n">DoneDict</span> <span class="o">=</span> <span class="n">DoneDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">:</span> <span class="n">OrderedDict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_episode_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_episode_id</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

        <span class="c1"># agent glue dict is a mapping from agent id to a dict with keys for the glue names</span>
        <span class="c1"># and values of the actual glue object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_agent_glue_dict</span><span class="p">:</span> <span class="n">OrderedDict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_agent_glue_obs_export_behavior</span><span class="p">:</span> <span class="n">OrderedDict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

        <span class="c1"># Create the logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">ACT3MultiAgentEnv</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

        <span class="c1"># Extra simulation init args</span>
        <span class="c1"># assign the new output_path with the worker index back to the config for the sim/integration output_path</span>
        <span class="n">extra_sim_init_args</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;output_path&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_path</span><span class="p">),</span>
            <span class="s2">&quot;worker_index&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">worker_index</span><span class="p">,</span>
            <span class="s2">&quot;vector_index&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">vector_index</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">vector_index</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="p">,</span> <span class="n">extra_sim_init_args</span><span class="p">[</span><span class="s2">&quot;agent_configs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env_creation</span><span class="o">.</span><span class="n">create_agent_sim_configs</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">agents</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">agent_platforms</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">simulator</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">platforms</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">epp_registry</span><span class="p">,</span>
            <span class="n">multiple_workers</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">num_workers</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">compute_lcm</span><span class="p">(</span><span class="n">values</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="n">lcm</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">denominator</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                <span class="n">lcm</span> <span class="o">=</span> <span class="n">lcm</span> <span class="o">//</span> <span class="n">math</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">lcm</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">denominator</span><span class="p">)</span> <span class="o">*</span> <span class="n">v</span><span class="o">.</span><span class="n">denominator</span>
            <span class="k">return</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">lcm</span>

        <span class="n">max_rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_agent_rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_agent_periods</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">agent_id</span><span class="p">:</span> <span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">agent</span><span class="o">.</span><span class="n">frame_rate</span><span class="p">)</span><span class="o">.</span><span class="n">limit_denominator</span><span class="p">(</span><span class="n">max_rate</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">agent_id</span><span class="p">,</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_agent_process_time</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">min</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_period</span> <span class="o">=</span> <span class="n">compute_lcm</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_agent_periods</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="n">extra_sim_init_args</span><span class="p">[</span><span class="s1">&#39;frame_rate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_period</span>

        <span class="k">for</span> <span class="n">agent_name</span><span class="p">,</span> <span class="n">platform</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">other_platforms</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">extra_sim_init_args</span><span class="p">[</span><span class="s2">&quot;agent_configs&quot;</span><span class="p">][</span><span class="n">agent_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;platform_config&quot;</span><span class="p">:</span> <span class="n">platform</span><span class="p">,</span>
                <span class="s2">&quot;parts_list&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="p">}</span>

        <span class="c1"># Debug logging</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;output_path : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Sample parameter provider</span>
        <span class="n">default_parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">epp</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">local_variable_store</span> <span class="o">=</span> <span class="n">flatten_dict</span><span class="o">.</span><span class="n">unflatten</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">default_parameters</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
        <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">fill_parameters</span><span class="p">(</span><span class="n">rng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">,</span> <span class="n">default_parameters</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Create the simulator for this gym environment</span>
        <span class="c1"># ----  oddity from other simulator bases HLP</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_simulator&quot;</span><span class="p">):</span>

            <span class="k">class</span> <span class="nc">SimulatorWrapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">simulator</span><span class="o">.</span><span class="n">type</span><span class="p">):</span>  <span class="c1"># type: ignore</span>
                <span class="sd">&quot;&quot;&quot;Wrapper that injects platforms/time into state dict&quot;&quot;&quot;</span>

                <span class="k">def</span> <span class="nf">_clear_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;sim_time&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">:</span>
                        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">[</span><span class="s1">&#39;sim_time&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="s1">&#39;sim_platforms&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">:</span>
                        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">[</span><span class="s1">&#39;sim_platforms&#39;</span><span class="p">]</span>

                <span class="k">def</span> <span class="nf">_inject_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">StateDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StateDict</span><span class="p">:</span>
                    <span class="sd">&quot;&quot;&quot;Ensures that time/platforms exists in state&quot;&quot;&quot;</span>
                    <span class="k">if</span> <span class="s1">&#39;sim_time&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
                        <span class="n">state</span><span class="p">[</span><span class="s1">&#39;sim_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span>

                    <span class="k">if</span> <span class="s1">&#39;sim_platforms&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
                        <span class="n">state</span><span class="p">[</span><span class="s1">&#39;sim_platforms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">platforms</span>

                    <span class="k">return</span> <span class="n">state</span>

                <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StateDict</span><span class="p">:</span>
                    <span class="sd">&quot;&quot;&quot;Steps the simulation - injects data into StateDict&quot;&quot;&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_clear_data</span><span class="p">()</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inject_data</span><span class="p">(</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">step</span><span class="p">())</span>

                <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StateDict</span><span class="p">:</span>
                    <span class="sd">&quot;&quot;&quot;Resets the simulation - injects data into StateDict&quot;&quot;&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_clear_data</span><span class="p">()</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inject_data</span><span class="p">(</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>

            <span class="n">simulator_factory</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">simulator</span><span class="p">)</span>
            <span class="n">simulator_factory</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">SimulatorWrapper</span>  <span class="c1"># type: ignore</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_simulator</span><span class="p">:</span> <span class="n">BaseSimulator</span> <span class="o">=</span> <span class="n">simulator_factory</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="o">**</span><span class="n">extra_sim_init_args</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_reset_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reset_simulator</span><span class="p">(</span><span class="n">extra_sim_init_args</span><span class="p">[</span><span class="s2">&quot;agent_configs&quot;</span><span class="p">])</span>

        <span class="c1"># Make the glue objects from the glue mapping now that we have a simulator created</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_make_glues</span><span class="p">()</span>

        <span class="c1"># create dictionary to hold done history</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__setup_state_history</span><span class="p">()</span>

        <span class="c1"># Create the observation and action space now that we have the glue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observation_space</span><span class="p">:</span> <span class="n">gym</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__create_space</span><span class="p">(</span><span class="n">space_getter</span><span class="o">=</span><span class="k">lambda</span> <span class="n">glue_obj</span><span class="p">:</span> <span class="n">glue_obj</span><span class="o">.</span><span class="n">observation_space</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_action_space</span><span class="p">:</span> <span class="n">gym</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__create_space</span><span class="p">(</span><span class="n">space_getter</span><span class="o">=</span><span class="k">lambda</span> <span class="n">glue_obj</span><span class="p">:</span> <span class="n">glue_obj</span><span class="o">.</span><span class="n">action_space</span><span class="p">())</span>
        <span class="n">gym_space_sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_action_space</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_normalized_observation_space</span><span class="p">:</span> <span class="n">gym</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__create_space</span><span class="p">(</span>
            <span class="n">space_getter</span><span class="o">=</span><span class="k">lambda</span> <span class="n">glue_obj</span><span class="p">:</span> <span class="n">glue_obj</span><span class="o">.</span><span class="n">normalized_observation_space</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">glue_obj</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">training_export_behavior</span> <span class="o">==</span> <span class="n">TrainingExportBehavior</span><span class="o">.</span><span class="n">INCLUDE</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_normalized_action_space</span><span class="p">:</span> <span class="n">gym</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__create_space</span><span class="p">(</span>
            <span class="n">space_getter</span><span class="o">=</span><span class="k">lambda</span> <span class="n">glue_obj</span><span class="p">:</span> <span class="n">glue_obj</span><span class="o">.</span><span class="n">normalized_action_space</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">gym_space_sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_normalized_action_space</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observation_units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__create_space</span><span class="p">(</span>
            <span class="n">space_getter</span><span class="o">=</span><span class="k">lambda</span> <span class="n">glue_obj</span><span class="p">:</span> <span class="n">glue_obj</span><span class="o">.</span><span class="n">observation_units</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">glue_obj</span><span class="p">,</span> <span class="s2">&quot;observation_units&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shared_done</span><span class="p">:</span> <span class="n">DoneDict</span> <span class="o">=</span> <span class="n">DoneDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_done_info</span><span class="p">:</span> <span class="n">OrderedDict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reward_info</span><span class="p">:</span> <span class="n">OrderedDict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_episode_init_params</span><span class="p">:</span> <span class="nb">dict</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">done_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_agent_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_action_space</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_skip_action</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_validator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">ACT3MultiAgentEnvValidator</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get the validator for this class.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ACT3MultiAgentEnvValidator</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># Sample parameter provider</span>
        <span class="n">current_parameters</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">epp</span><span class="o">.</span><span class="n">get_params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">local_variable_store</span> <span class="o">=</span> <span class="n">flatten_dict</span><span class="o">.</span><span class="n">unflatten</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">current_parameters</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
        <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">fill_parameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>

        <span class="c1"># 3. Reset the Done and Reward dictionaries for the next iteration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_make_rewards</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_make_dones</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shared_done</span><span class="p">:</span> <span class="n">DoneDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_shared_dones</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_reward</span><span class="p">:</span> <span class="n">RewardDict</span> <span class="o">=</span> <span class="n">RewardDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_done</span><span class="p">:</span> <span class="n">DoneDict</span> <span class="o">=</span> <span class="n">DoneDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_done_info</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_default_done_reward</span><span class="p">()</span>
        <span class="c1"># 4. Reset the simulation/integration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_reset_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reset_simulator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_episode_length</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_agent_process_time</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c1">#####################################################################</span>
        <span class="c1"># Make glue sections - Given the state of the simulation we need to</span>
        <span class="c1"># update the platform interfaces.</span>
        <span class="c1">#####################################################################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_make_glues</span><span class="p">()</span>

        <span class="c1">#####################################################################</span>
        <span class="c1"># get observations</span>
        <span class="c1"># For each configured agent read the observations/measurements</span>
        <span class="c1">#####################################################################</span>
        <span class="n">agent_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">next_observation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_observations_from_glues</span><span class="p">(</span><span class="n">agent_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">update_obs_pointer</span><span class="p">()</span>
        <span class="c1"># The following loop guarantees that durring training that the glue</span>
        <span class="c1"># states start with valid values for rates. The number of recommended</span>
        <span class="c1"># steps for sim is at least equal to the depth of the rate observation</span>
        <span class="c1"># tree (ex: speed - 2, acceleration - 3, jerk - 4) - recommend defaulting</span>
        <span class="c1"># to 4 as we do not go higher thank jerk</span>
        <span class="c1"># 1 step is always added for the inital obs in reset</span>
        <span class="n">warmup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sim_warmup_steps</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">warmup</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simulator</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">next_observation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_observations_from_glues</span><span class="p">(</span><span class="n">agent_list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">update_obs_pointer</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__setup_state_history</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">platform</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">sim_platforms</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">step_state</span><span class="p">[</span><span class="n">platform</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">episode_history</span><span class="p">[</span><span class="n">platform</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">episode_state</span><span class="p">[</span><span class="n">platform</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

        <span class="c1"># Sanity Checks and Scale</span>
        <span class="c1"># The current deep sanity check will not raise error if values are from sample are different from space during reset</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">deep_sanity_check</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__sanity_check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_space</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">observation</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_save_state_pickle</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observation_space</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">observation</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;obs not contained in obs space&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_create_actions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">observation</span><span class="p">)</span>

        <span class="c1">#####################################################################</span>
        <span class="c1"># return results to RLLIB - Note that RLLIB does not do a recursive</span>
        <span class="c1"># isinstance call and as such need to make sure items are</span>
        <span class="c1"># OrderedDicts</span>
        <span class="c1">#####################################################################</span>
        <span class="n">trainable_observations</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_training_observations</span><span class="p">(</span><span class="n">agent_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">trainable_observations</span>

    <span class="k">def</span> <span class="nf">_reset_simulator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_configs</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="n">StateDict</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]]:</span>

        <span class="n">sim_reset_args</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">simulator_reset_parameters</span><span class="p">)</span>
        <span class="n">v_store</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_variable_store</span>
        <span class="n">deepmerge</span><span class="o">.</span><span class="n">always_merger</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">sim_reset_args</span><span class="p">,</span> <span class="n">v_store</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;simulator_reset&#39;</span><span class="p">,</span> <span class="p">{}))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_process_references</span><span class="p">(</span><span class="n">sim_reset_args</span><span class="p">,</span> <span class="n">v_store</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">agent_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">deepmerge</span><span class="o">.</span><span class="n">always_merger</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                <span class="n">sim_reset_args</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;platforms&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="n">agent_data</span><span class="o">.</span><span class="n">platform_name</span><span class="p">:</span> <span class="n">agent_data</span><span class="o">.</span><span class="n">get_simulator_reset_parameters</span><span class="p">()</span>
                <span class="p">}}</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">agent_configs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sim_reset_args</span><span class="p">[</span><span class="s2">&quot;agent_configs_reset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">agent_configs</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simulator</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">sim_reset_args</span><span class="p">),</span> <span class="n">sim_reset_args</span>

    <span class="k">def</span> <span class="nf">_process_references</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim_reset_args</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">v_store</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Process the reference store look ups for the position data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sim_reset_args : dict</span>
<span class="sd">            The simulator reset parameters</span>
<span class="sd">        v_store : dict</span>
<span class="sd">            The variable store</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plat_str</span> <span class="o">=</span> <span class="s2">&quot;platforms&quot;</span>
        <span class="n">pos_str</span> <span class="o">=</span> <span class="s2">&quot;position&quot;</span>
        <span class="n">ref_str</span> <span class="o">=</span> <span class="s2">&quot;reference&quot;</span>
        <span class="k">if</span> <span class="n">plat_str</span> <span class="ow">in</span> <span class="n">sim_reset_args</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">plat_k</span><span class="p">,</span> <span class="n">plat_v</span> <span class="ow">in</span> <span class="n">sim_reset_args</span><span class="p">[</span><span class="n">plat_str</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">pos_str</span> <span class="ow">in</span> <span class="n">plat_v</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">position_k</span><span class="p">,</span> <span class="n">position_v</span> <span class="ow">in</span> <span class="n">plat_v</span><span class="p">[</span><span class="n">pos_str</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">position_v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ref_str</span> <span class="ow">in</span> <span class="n">position_v</span><span class="p">:</span>
                            <span class="n">sim_reset_args</span><span class="p">[</span><span class="n">plat_str</span><span class="p">][</span><span class="n">plat_k</span><span class="p">][</span><span class="n">pos_str</span><span class="p">][</span><span class="n">position_k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v_store</span><span class="p">[</span><span class="s2">&quot;reference_store&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                                <span class="n">position_v</span><span class="p">[</span><span class="n">ref_str</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reference_store</span><span class="p">[</span><span class="n">position_v</span><span class="p">[</span><span class="n">ref_str</span><span class="p">]]</span>
                            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_operable_agents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determines which agents are operable in the sim, this becomes stale after the simulation is stepped&quot;&quot;&quot;</span>
        <span class="n">operable_platform_names</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">item</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">sim_platforms</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">operable</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">episode_state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">{})</span>
        <span class="p">]</span>

        <span class="n">operable_agents</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">agent_name</span><span class="p">,</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">platform_name</span> <span class="ow">in</span> <span class="n">operable_platform_names</span><span class="p">:</span>
                <span class="n">operable_agents</span><span class="p">[</span><span class="n">agent_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">agent</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">agent</span><span class="o">.</span><span class="n">set_removed</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">operable_agents</span>

    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="n">OrderedDict</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">]:</span>
        <span class="c1"># pylint: disable=R0912, R0914, R0915</span>
        <span class="sd">&quot;&quot;&quot;Returns observations from ready agents.</span>

<span class="sd">        The returns are dicts mapping from agent_id strings to values. The</span>
<span class="sd">        number of agents in the env can vary over time.</span>

<span class="sd">            obs (StateDict): New observations for each ready agent.</span>
<span class="sd">                episode is just started, the value will be None.</span>
<span class="sd">            dones (StateDict): Done values for each ready agent. The</span>
<span class="sd">                special key &quot;__all__&quot; (required) is used to indicate env</span>
<span class="sd">                termination.</span>
<span class="sd">            infos (StateDict): Optional info values for each agent id.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_episode_length</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">operable_agents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_operable_agents</span><span class="p">()</span>

        <span class="c1"># look to add this bugsplat, but this check won&#39;t work for multi fps</span>
        <span class="c1"># if set(operable_agents.keys()) != set(action_dict.keys()):</span>
        <span class="c1">#     raise RuntimeError(&quot;Operable_agents and action_dict keys differ!&quot;</span>
        <span class="c1">#                        f&quot;operable={set(operable_agents.keys())} != act={set(action_dict.keys())} &quot;</span>
        <span class="c1">#                        &quot;If this happens that means either your platform is not setting non operable correctly&quot;</span>
        <span class="c1">#                        &quot; (if extra keys are in operable set) or you do not have a done condition covering &quot;</span>
        <span class="c1">#                        &quot;a condition where your platform is going non operable. (if extra keys in act)&quot;)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_action</span><span class="p">:</span>
            <span class="n">raw_action_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">raw_action_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__apply_action</span><span class="p">(</span><span class="n">operable_agents</span><span class="p">,</span> <span class="n">action_dict</span><span class="p">)</span>

        <span class="c1"># Save current action for future debugging</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action_dict</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simulator</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_state_pickle</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>

        <span class="c1"># MTB - Changing to not replace operable_agents variable</span>
        <span class="c1">#       We calculate observations on agents operable after sim step</span>
        <span class="c1">#       - This is done because otherwise observations would be invalid</span>
        <span class="c1">#       Calculate Dones/Rewards on agents operable before sim step</span>
        <span class="c1">#       - This is done because if an agent &quot;dies&quot; it needs to have a final done calculated</span>
        <span class="n">operable_agents_after_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_operable_agents</span><span class="p">()</span>

        <span class="c1">#####################################################################</span>
        <span class="c1"># get next observations - For each configured platform read the</span>
        <span class="c1"># observations/measurements</span>
        <span class="c1">#####################################################################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">next_observation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_observations_from_glues</span><span class="p">(</span><span class="n">operable_agents_after_step</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__get_info_from_glue</span><span class="p">(</span><span class="n">operable_agents_after_step</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1">#####################################################################</span>
        <span class="c1"># Process the done conditions</span>
        <span class="c1"># 1. Reset the rewards from the last step</span>
        <span class="c1"># 2. loops over all agents and processes the reward conditions per</span>
        <span class="c1">#    agent</span>
        <span class="c1">#####################################################################</span>

        <span class="n">agents_done</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_done_from_agents</span><span class="p">(</span><span class="n">operable_agents</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">raw_action_dict</span><span class="o">=</span><span class="n">raw_action_dict</span><span class="p">)</span>

        <span class="n">expected_done_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">operable_agents</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">expected_done_keys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;__all__&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">agents_done</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">!=</span> <span class="n">expected_done_keys</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Local dones do not match expected keys.  Received &quot;</span><span class="si">{</span><span class="n">agents_done</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s1">&quot;.  Expected &quot;</span><span class="si">{</span><span class="n">expected_done_keys</span><span class="si">}</span><span class="s1">&quot;.&#39;</span>
            <span class="p">)</span>

        <span class="c1"># compute if done all</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">agents_done</span><span class="p">[</span><span class="s1">&#39;__all__&#39;</span><span class="p">]:</span>
            <span class="n">agent_dones</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">agents_done</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;__all__&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">end_episode_on_first_agent_done</span><span class="p">:</span>
                <span class="n">agents_done</span><span class="p">[</span><span class="s1">&#39;__all__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">agent_dones</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">agents_done</span><span class="p">[</span><span class="s1">&#39;__all__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">agent_dones</span><span class="p">)</span>

        <span class="n">shared_dones</span><span class="p">,</span> <span class="n">shared_done_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shared_done</span><span class="p">(</span>
            <span class="n">observation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">observation</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="n">raw_action_dict</span><span class="p">,</span>
            <span class="n">next_observation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">next_observation</span><span class="p">,</span>
            <span class="n">next_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">,</span>
            <span class="n">observation_space</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_space</span><span class="p">,</span>
            <span class="n">observation_units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_units</span><span class="p">,</span>
            <span class="n">local_dones</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">agents_done</span><span class="p">),</span>
            <span class="n">local_done_info</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_done_info</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">shared_dones</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">shared_dones</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">!=</span> <span class="n">expected_done_keys</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Shared dones do not match expected keys.  Received &quot;</span><span class="si">{</span><span class="n">shared_dones</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s1">&quot;.  Expected &quot;</span><span class="si">{</span><span class="n">expected_done_keys</span><span class="si">}</span><span class="s1">&quot;.&#39;</span>
                <span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">expected_done_keys</span><span class="p">:</span>
                <span class="n">agents_done</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">|=</span> <span class="n">shared_dones</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="k">assert</span> <span class="n">shared_done_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="n">local_done_info_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_done_info</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">shared_done_info_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">shared_done_info</span><span class="p">)</span>
        <span class="n">common_keys</span> <span class="o">=</span> <span class="n">local_done_info_keys</span> <span class="o">&amp;</span> <span class="n">shared_done_info_keys</span>
        <span class="k">if</span> <span class="n">common_keys</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Dones have common names: &quot;</span><span class="si">{</span><span class="n">common_keys</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">done_name</span><span class="p">,</span> <span class="n">done_keys</span> <span class="ow">in</span> <span class="n">shared_done_info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">agent_name</span><span class="p">,</span> <span class="n">done_status</span> <span class="ow">in</span> <span class="n">done_keys</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_done_info</span><span class="p">[</span><span class="n">agent_name</span><span class="p">][</span><span class="n">done_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="p">[</span><span class="n">agent_name</span><span class="p">]</span><span class="o">.</span><span class="n">platform_name</span><span class="p">,</span> <span class="n">done_status</span><span class="p">)])</span>

        <span class="c1"># compute if done all</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">agents_done</span><span class="p">[</span><span class="s1">&#39;__all__&#39;</span><span class="p">]:</span>
            <span class="n">agent_dones</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">agents_done</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;__all__&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">end_episode_on_first_agent_done</span><span class="p">:</span>
                <span class="n">agents_done</span><span class="p">[</span><span class="s1">&#39;__all__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">agent_dones</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">agents_done</span><span class="p">[</span><span class="s1">&#39;__all__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">agent_dones</span><span class="p">)</span>

        <span class="c1"># Tell the simulator to mark the episode complete</span>
        <span class="k">if</span> <span class="n">agents_done</span><span class="p">[</span><span class="s1">&#39;__all__&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_simulator</span><span class="o">.</span><span class="n">mark_episode_done</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_done_info</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">episode_state</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_reward</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">agents_done</span><span class="p">[</span><span class="s1">&#39;__all__&#39;</span><span class="p">]:</span>
            <span class="n">agents_to_process_this_timestep</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">operable_agents</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">do_process_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_id</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
                <span class="n">frame_rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent_periods</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span><span class="o">.</span><span class="n">numerator</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent_periods</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span><span class="o">.</span><span class="n">denominator</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">sim_time</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent_process_time</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span> <span class="o">+</span> <span class="n">frame_rate</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">timestep_epsilon</span>

            <span class="n">agents_to_process_this_timestep</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">do_process_agent</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span> <span class="n">operable_agents</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

        <span class="k">for</span> <span class="n">agent_id</span> <span class="ow">in</span> <span class="n">agents_to_process_this_timestep</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_agent_process_time</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">sim_time</span>

        <span class="n">reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_reward_from_agents</span><span class="p">(</span><span class="n">agents_to_process_this_timestep</span><span class="p">,</span> <span class="n">raw_action_dict</span><span class="o">=</span><span class="n">raw_action_dict</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_simulator</span><span class="o">.</span><span class="n">save_episode_information</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">done_info</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reward_info</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">observation</span><span class="p">)</span>
        <span class="c1"># copy over observation from next to previous - There is no real reason to deep</span>
        <span class="c1"># copy here. The process of getting a new observation from the glue copies. All</span>
        <span class="c1"># we need to do is maintain the order of two buffers!!!.</span>
        <span class="c1"># Tested with: They are different and decreasing as expected</span>
        <span class="c1">#   print(f&quot;C: {self._obs_buffer.observation[&#39;blue0&#39;][&#39;ObserveSensor_Sensor_Fuel&#39;]}&quot;)</span>
        <span class="c1">#   print(f&quot;N: {self._obs_buffer.next_observation[&#39;blue0&#39;][&#39;ObserveSensor_Sensor_Fuel&#39;]}&quot;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">update_obs_pointer</span><span class="p">()</span>
        <span class="c1"># Sanity checks and Scale - ensure run first time and run only every N times...</span>
        <span class="c1"># Same as RLLIB - This can add a bit of time as we are exploring complex dictionaries</span>
        <span class="c1"># default to every time if not specified... Once the limits are good we it is</span>
        <span class="c1"># recommended to increase this for training</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">deep_sanity_check</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode_length</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sanity_check_obs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__sanity_check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_space</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">observation</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_save_state_pickle</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observation_space</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">observation</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;obs not contained in obs space&#39;</span><span class="p">)</span>

        <span class="n">complete_trainable_observations</span><span class="p">,</span> <span class="n">complete_unnormalized_observations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_training_observations</span><span class="p">(</span>
            <span class="n">operable_agents</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span>
        <span class="p">)</span>
        <span class="n">trainable_observations</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">agent_id</span> <span class="ow">in</span> <span class="n">agents_to_process_this_timestep</span><span class="p">:</span>
            <span class="n">trainable_observations</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">complete_trainable_observations</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span>

        <span class="n">trainable_rewards</span> <span class="o">=</span> <span class="n">get_dictionary_subset</span><span class="p">(</span><span class="n">reward</span><span class="p">,</span> <span class="n">agents_to_process_this_timestep</span><span class="p">)</span>
        <span class="n">trainable_dones</span> <span class="o">=</span> <span class="n">get_dictionary_subset</span><span class="p">(</span><span class="n">agents_done</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;__all__&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">agents_to_process_this_timestep</span><span class="p">)</span>
        <span class="n">trainable_info</span> <span class="o">=</span> <span class="n">get_dictionary_subset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">,</span> <span class="n">agents_to_process_this_timestep</span><span class="p">)</span>

        <span class="c1"># add platform obs and env data to trainable_info (for use by custom policies)</span>
        <span class="k">for</span> <span class="n">agent_id</span> <span class="ow">in</span> <span class="n">agents_to_process_this_timestep</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">agent_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">trainable_info</span><span class="p">:</span>
                <span class="n">trainable_info</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="n">trainable_info</span><span class="p">[</span><span class="n">agent_id</span><span class="p">][</span><span class="s1">&#39;env&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;sim_period&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_period</span><span class="p">}</span>
            <span class="n">trainable_info</span><span class="p">[</span><span class="n">agent_id</span><span class="p">][</span><span class="s1">&#39;platform_obs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="n">plat_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span><span class="o">.</span><span class="n">platform_name</span>
            <span class="k">for</span> <span class="n">platform_agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="p">[</span><span class="n">platform_agent</span><span class="p">]</span><span class="o">.</span><span class="n">platform_name</span> <span class="o">==</span> <span class="n">plat_name</span><span class="p">:</span>
                    <span class="n">trainable_info</span><span class="p">[</span><span class="n">agent_id</span><span class="p">][</span><span class="s1">&#39;platform_obs&#39;</span><span class="p">][</span><span class="n">platform_agent</span><span class="p">]</span> <span class="o">=</span> <span class="n">complete_unnormalized_observations</span><span class="p">[</span><span class="n">platform_agent</span><span class="p">]</span>

        <span class="c1"># if not done all, delete any platforms from simulation that are done, so they don&#39;t interfere</span>
        <span class="n">platforms_deleted</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">agents_done</span><span class="p">[</span><span class="s1">&#39;__all__&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">agent_key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">agents_done</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">agent_key</span> <span class="o">!=</span> <span class="s1">&#39;__all__&#39;</span> <span class="ow">and</span> <span class="n">value</span><span class="p">:</span>
                    <span class="n">plat_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="p">[</span><span class="n">agent_key</span><span class="p">]</span><span class="o">.</span><span class="n">platform_name</span>
                    <span class="k">if</span> <span class="n">plat_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">platforms_deleted</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">simulator</span><span class="o">.</span><span class="n">delete_platform</span><span class="p">(</span><span class="n">plat_name</span><span class="p">)</span>
                        <span class="n">platforms_deleted</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">plat_name</span><span class="p">)</span>

        <span class="c1"># if a platform has been deleted, we need to make sure that all agents on that platform</span>
        <span class="c1"># are also done</span>
        <span class="k">for</span> <span class="n">agent_key</span> <span class="ow">in</span> <span class="n">trainable_dones</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">agent_key</span> <span class="o">==</span> <span class="s1">&#39;__all__&#39;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">plat_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="p">[</span><span class="n">agent_key</span><span class="p">]</span><span class="o">.</span><span class="n">platform_name</span>
            <span class="k">if</span> <span class="n">plat_name</span> <span class="ow">in</span> <span class="n">platforms_deleted</span><span class="p">:</span>
                <span class="n">trainable_dones</span><span class="p">[</span><span class="n">agent_key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1">#####################################################################</span>
        <span class="c1"># return results to RLLIB - Note that RLLIB does not do a recursive</span>
        <span class="c1"># isinstance call and as such need to make sure items are</span>
        <span class="c1"># OrderedDicts</span>
        <span class="c1">#####################################################################</span>
        <span class="k">return</span> <span class="n">trainable_observations</span><span class="p">,</span> <span class="n">trainable_rewards</span><span class="p">,</span> <span class="n">trainable_dones</span><span class="p">,</span> <span class="n">trainable_info</span>

    <span class="k">def</span> <span class="nf">__get_done_from_agents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alive_agents</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">raw_action_dict</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">or_merge</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">nxt</span><span class="p">):</span>  <span class="c1"># pylint: disable=unused-argument</span>
            <span class="k">return</span> <span class="n">base</span> <span class="ow">or</span> <span class="n">nxt</span>

        <span class="n">merge_strategies</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">deepmerge</span><span class="o">.</span><span class="n">DEFAULT_TYPE_SPECIFIC_MERGE_STRATEGIES</span><span class="p">)</span>
        <span class="n">merge_strategies</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">bool</span><span class="p">,</span> <span class="n">or_merge</span><span class="p">))</span>
        <span class="n">or_merger</span> <span class="o">=</span> <span class="n">deepmerge</span><span class="o">.</span><span class="n">Merger</span><span class="p">(</span><span class="n">merge_strategies</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[])</span>

        <span class="n">done</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">done</span><span class="p">[</span><span class="s2">&quot;__all__&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">agent_id</span> <span class="ow">in</span> <span class="n">alive_agents</span><span class="p">:</span>
            <span class="n">agent_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span>
            <span class="n">platform_done</span><span class="p">,</span> <span class="n">done_info</span> <span class="o">=</span> <span class="n">agent_class</span><span class="o">.</span><span class="n">get_dones</span><span class="p">(</span>
                <span class="n">observation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">observation</span><span class="p">,</span>
                <span class="n">action</span><span class="o">=</span><span class="n">raw_action_dict</span><span class="p">,</span>
                <span class="n">next_observation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">next_observation</span><span class="p">,</span>
                <span class="n">next_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">,</span>
                <span class="n">observation_space</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_space</span><span class="p">,</span>
                <span class="n">observation_units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_units</span>
            <span class="p">)</span>
            <span class="n">done</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">platform_done</span><span class="p">[</span><span class="n">agent_class</span><span class="o">.</span><span class="n">platform_name</span><span class="p">]</span>
            <span class="c1"># get around reduction</span>
            <span class="n">done</span><span class="p">[</span><span class="s2">&quot;__all__&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">done</span><span class="p">[</span><span class="s2">&quot;__all__&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">done</span><span class="p">[</span><span class="s2">&quot;__all__&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="n">platform_done</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;__all__&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">or_merger</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_done_info</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">agent_id</span><span class="p">,</span> <span class="p">{}),</span> <span class="n">done_info</span><span class="p">)</span>
            <span class="c1"># self._done_info[agent_id] = done_info</span>
        <span class="k">return</span> <span class="n">done</span>

    <span class="k">def</span> <span class="nf">__get_reward_from_agents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alive_agents</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">raw_action_dict</span><span class="p">):</span>
        <span class="n">reward</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">agent_id</span> <span class="ow">in</span> <span class="n">alive_agents</span><span class="p">:</span>
            <span class="n">agent_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span>
            <span class="n">agent_reward</span><span class="p">,</span> <span class="n">reward_info</span> <span class="o">=</span> <span class="n">agent_class</span><span class="o">.</span><span class="n">get_rewards</span><span class="p">(</span>
                <span class="n">observation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">observation</span><span class="p">,</span>
                <span class="n">action</span><span class="o">=</span><span class="n">raw_action_dict</span><span class="p">,</span>
                <span class="n">next_observation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">next_observation</span><span class="p">,</span>
                <span class="n">state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">,</span>
                <span class="n">next_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">,</span>
                <span class="n">observation_space</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_space</span><span class="p">,</span>
                <span class="n">observation_units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_units</span>
            <span class="p">)</span>
            <span class="c1"># it is possible to have a HL policy that does not compute an reward</span>
            <span class="c1"># in this case just return a zero for reward value</span>
            <span class="k">if</span> <span class="n">agent_id</span> <span class="ow">in</span> <span class="n">agent_reward</span><span class="p">:</span>
                <span class="n">reward</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">agent_reward</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">reward</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reward_info</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">reward_info</span>
        <span class="k">return</span> <span class="n">reward</span>

    <span class="k">def</span> <span class="nf">set_default_done_reward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Populate the done/rewards with default values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>  <span class="c1"># pylint: disable=C0201</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_done</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reward</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># pylint: disable=protected-access</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_shared_done</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_done</span><span class="p">[</span><span class="n">DoneFuncBase</span><span class="o">.</span><span class="n">_ALL</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># pylint: disable=protected-access</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shared_done</span><span class="p">[</span><span class="n">DoneFuncBase</span><span class="o">.</span><span class="n">_ALL</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># pylint: disable=protected-access</span>

    <span class="k">def</span> <span class="nf">create_training_observations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alive_agents</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                                     <span class="n">observations</span><span class="p">:</span> <span class="n">ObsBuffer</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="n">OrderedDict</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Filters and normalizes observations (the sample of the space) using the glue normalize functions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        alive_agents:</span>
<span class="sd">            The agents that are still alive</span>
<span class="sd">        observations:</span>
<span class="sd">            The observations</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        OrderedDict:</span>
<span class="sd">            the filtered/normalized observation samples</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">this_steps_obs</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">agent_id</span> <span class="ow">in</span> <span class="n">alive_agents</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">agent_id</span> <span class="ow">in</span> <span class="n">observations</span><span class="o">.</span><span class="n">observation</span><span class="p">:</span>
                <span class="n">this_steps_obs</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">observations</span><span class="o">.</span><span class="n">observation</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">agent_id</span> <span class="ow">in</span> <span class="n">observations</span><span class="o">.</span><span class="n">next_observation</span><span class="p">:</span>
                <span class="n">this_steps_obs</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">observations</span><span class="o">.</span><span class="n">next_observation</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;ERROR: create_training_observations tried to retrieve obs for this training step&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; but </span><span class="si">{</span><span class="n">agent_id</span><span class="si">=}</span><span class="s2"> was not able to be found in either the current obs data or the &quot;</span>
                    <span class="s2">&quot; obs from the previous timestep as a fallback&quot;</span>
                <span class="p">)</span>

        <span class="k">def</span> <span class="nf">do_export</span><span class="p">(</span><span class="n">agent_id</span><span class="p">,</span> <span class="n">obs_name</span><span class="p">,</span> <span class="n">_obs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">agent_id</span> <span class="ow">in</span> <span class="n">alive_agents</span><span class="p">:</span>
                <span class="n">glue_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span><span class="o">.</span><span class="n">get_glue</span><span class="p">(</span><span class="n">obs_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">glue_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">glue_obj</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">training_export_behavior</span> <span class="o">==</span> <span class="n">TrainingExportBehavior</span><span class="o">.</span><span class="n">INCLUDE</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">filtered_observations</span> <span class="o">=</span> <span class="n">filter_observations</span><span class="p">(</span><span class="n">this_steps_obs</span><span class="p">,</span> <span class="n">do_export</span><span class="p">)</span>

        <span class="n">normalized_observations</span> <span class="o">=</span> <span class="n">mutate_observations</span><span class="p">(</span>
            <span class="n">filtered_observations</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">agent_id</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
            <span class="n">obs_name</span><span class="p">,</span>
            <span class="n">obs</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span><span class="o">.</span><span class="n">normalize_observation</span><span class="p">(</span><span class="n">obs_name</span><span class="p">,</span> <span class="n">obs</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">normalized_observations</span><span class="p">,</span> <span class="n">filtered_observations</span>

    <span class="k">def</span> <span class="nf">__get_observations_from_glues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alive_agents</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">:</span>  <span class="c1"># pylint: disable=protected-access</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the observation dict from all the glue objects for each agent</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        OrderedDict:</span>
<span class="sd">            The observation dict from all the glues</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">return_observation</span><span class="p">:</span> <span class="n">OrderedDict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">p_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">sim_platforms</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">agent_id</span> <span class="ow">in</span> <span class="n">alive_agents</span><span class="p">:</span>
            <span class="n">agent_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span>
            <span class="c1"># TODO: Why is this check required here?</span>
            <span class="c1"># Why does &#39;alive_agents&#39; contain agents with platforms that don&#39;t exist (or have been removed)?</span>
            <span class="c1"># This should only happpen if the user has accidentally passed in &#39;dead&#39; agents</span>
            <span class="k">if</span> <span class="n">agent_class</span><span class="o">.</span><span class="n">platform_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p_names</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent_id</span><span class="si">}</span><span class="s2"> on </span><span class="si">{</span><span class="n">agent_class</span><span class="o">.</span><span class="n">platform_name</span><span class="si">}</span><span class="s2"> is not in the list of (alive) sim_platforms: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">sim_platforms</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="n">agent_class</span><span class="o">.</span><span class="n">set_removed</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">glue_obj_obs</span> <span class="o">=</span> <span class="n">agent_class</span><span class="o">.</span><span class="n">get_observations</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">glue_obj_obs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">return_observation</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">glue_obj_obs</span>
        <span class="k">return</span> <span class="n">return_observation</span>

    <span class="k">def</span> <span class="nf">__apply_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operable_agents</span><span class="p">,</span> <span class="n">action_dict</span><span class="p">):</span>
        <span class="n">raw_action_dict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">agent_id</span><span class="p">,</span> <span class="n">agent_class</span> <span class="ow">in</span> <span class="n">operable_agents</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">agent_id</span> <span class="ow">in</span> <span class="n">action_dict</span><span class="p">:</span>
                <span class="n">raw_action_dict</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">agent_class</span><span class="o">.</span><span class="n">apply_action</span><span class="p">(</span><span class="n">action_dict</span><span class="p">[</span><span class="n">agent_id</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">raw_action_dict</span>

    <span class="k">def</span> <span class="nf">__get_info_from_glue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alive_agents</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">agent_id</span> <span class="ow">in</span> <span class="n">alive_agents</span><span class="p">:</span>
            <span class="n">agent_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span>
            <span class="n">glue_obj_info</span> <span class="o">=</span> <span class="n">agent_class</span><span class="o">.</span><span class="n">get_info_dict</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">glue_obj_info</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">glue_obj_info</span>

    <span class="k">def</span> <span class="nf">_get_observation_units_from_glues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">:</span>  <span class="c1"># pylint: disable=protected-access</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the observation dict from all the glue objects for each agent</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        OrderedDict:</span>
<span class="sd">            The observation dict from all the glues</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">return_observation</span><span class="p">:</span> <span class="n">OrderedDict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">p_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">sim_platforms</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">agent_id</span><span class="p">,</span> <span class="n">glue_name_obj_pair</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent_glue_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">glue_name</span><span class="p">,</span> <span class="n">glue_object</span> <span class="ow">in</span> <span class="n">glue_name_obj_pair</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">glue_object</span><span class="o">.</span><span class="n">_agent_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p_names</span><span class="p">:</span>  <span class="c1"># pylint: disable=protected-access</span>
                    <span class="n">glue_object</span><span class="o">.</span><span class="n">set_agent_removed</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">glue_obj_obs</span> <span class="o">=</span> <span class="n">glue_object</span><span class="o">.</span><span class="n">observation_units</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="n">glue_obj_obs</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="n">return_observation</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">agent_id</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">())[</span><span class="n">glue_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">glue_obj_obs</span>
        <span class="k">return</span> <span class="n">return_observation</span>

    <span class="k">def</span> <span class="nf">_make_glues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">env_ref_stores</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">local_variable_store</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reference_store&#39;</span><span class="p">,</span> <span class="p">{}),</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reference_store</span><span class="p">]</span>

        <span class="n">plat_to_agent</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="n">agent</span><span class="p">,</span> <span class="n">agent_class</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># get the platform for this agent</span>
            <span class="n">plat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_platform_by_name</span><span class="p">(</span><span class="n">agent_class</span><span class="o">.</span><span class="n">platform_name</span><span class="p">)</span>
            <span class="n">plat_to_agent</span><span class="p">[</span><span class="n">plat</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>

            <span class="n">agent_class</span><span class="o">.</span><span class="n">make_glues</span><span class="p">(</span><span class="n">plat</span><span class="p">,</span> <span class="n">agent</span><span class="p">,</span> <span class="n">env_ref_stores</span><span class="o">=</span><span class="n">env_ref_stores</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">simulator</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;disable_exclusivity_check&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="k">def</span> <span class="nf">itr_controller_glues</span><span class="p">(</span><span class="n">glue</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">glue</span><span class="p">,</span> <span class="n">BaseAgentControllerGlue</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">glue</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">glue</span><span class="p">,</span> <span class="n">BaseWrapperGlue</span><span class="p">):</span>
                <span class="k">yield from</span> <span class="n">itr_controller_glues</span><span class="p">(</span><span class="n">glue</span><span class="o">.</span><span class="n">glue</span><span class="p">())</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">glue</span><span class="p">,</span> <span class="n">BaseDictWrapperGlue</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">glue</span><span class="o">.</span><span class="n">glues</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="k">yield from</span> <span class="n">itr_controller_glues</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">glue</span><span class="p">,</span> <span class="n">BaseMultiWrapperGlue</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">glue</span><span class="o">.</span><span class="n">glues</span><span class="p">():</span>
                    <span class="k">yield from</span> <span class="n">itr_controller_glues</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

        <span class="c1"># validate</span>
        <span class="k">for</span> <span class="n">plat_name</span><span class="p">,</span> <span class="n">agents</span> <span class="ow">in</span> <span class="n">plat_to_agent</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">exclusiveness</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="n">agents</span><span class="p">:</span>
                <span class="n">agent_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">glue</span> <span class="ow">in</span> <span class="n">agent_class</span><span class="o">.</span><span class="n">agent_glue_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">controller_glue</span> <span class="ow">in</span> <span class="n">itr_controller_glues</span><span class="p">(</span><span class="n">glue</span><span class="p">):</span>
                        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">controller_glue</span><span class="p">,</span> <span class="n">ControllerGlue</span>
                                          <span class="p">),</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown controller glue type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">controller_glue</span><span class="p">)</span><span class="si">}</span><span class="s2"> on platform </span><span class="si">{</span><span class="n">plat_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">controller_exclusiveness</span> <span class="o">=</span> <span class="n">controller_glue</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">exclusiveness</span>
                        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">controller_exclusiveness</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">exclusiveness</span><span class="p">)</span>
                                   <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Controllers not mutually exclusive on platform </span><span class="si">{</span><span class="n">plat_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">exclusiveness</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">controller_exclusiveness</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_make_rewards</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">env_ref_stores</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">local_variable_store</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reference_store&#39;</span><span class="p">,</span> <span class="p">{}),</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reference_store</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">agent</span><span class="p">,</span> <span class="n">agent_class</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">agent_class</span><span class="o">.</span><span class="n">make_rewards</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">env_ref_stores</span><span class="o">=</span><span class="n">env_ref_stores</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_make_dones</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">env_ref_stores</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">local_variable_store</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reference_store&#39;</span><span class="p">,</span> <span class="p">{}),</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reference_store</span><span class="p">]</span>

        <span class="n">warmup_steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sim_warmup_steps</span>
        <span class="n">episode_length_done</span> <span class="o">=</span> <span class="n">Functor</span><span class="p">(</span>
            <span class="n">functor</span><span class="o">=</span><span class="n">EpisodeLengthDone</span><span class="p">,</span>
            <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;horizon&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">horizon</span> <span class="o">+</span> <span class="n">warmup_steps</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_period</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;second&#39;</span>
            <span class="p">}}</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">agent</span><span class="p">,</span> <span class="n">agent_class</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">env_dones</span> <span class="o">=</span> <span class="n">chain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dones</span><span class="o">.</span><span class="n">world</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dones</span><span class="o">.</span><span class="n">task</span><span class="p">[</span><span class="n">agent_class</span><span class="o">.</span><span class="n">platform_name</span><span class="p">],</span> <span class="p">[</span><span class="n">episode_length_done</span><span class="p">])</span>
            <span class="n">env_params</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">local_variable_store</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;world&#39;</span><span class="p">,</span> <span class="p">{}),</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_variable_store</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;task&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">agent_class</span><span class="o">.</span><span class="n">platform_name</span><span class="p">,</span> <span class="p">{})</span>
            <span class="p">]</span>
            <span class="n">agent_class</span><span class="o">.</span><span class="n">make_dones</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">agent_class</span><span class="o">.</span><span class="n">platform_name</span><span class="p">,</span> <span class="n">dones</span><span class="o">=</span><span class="n">env_dones</span><span class="p">,</span> <span class="n">env_params</span><span class="o">=</span><span class="n">env_params</span><span class="p">,</span> <span class="n">env_ref_stores</span><span class="o">=</span><span class="n">env_ref_stores</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_make_shared_dones</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DoneDict</span><span class="p">:</span>  <span class="c1"># pylint: disable=no-self-use</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        _get_shared_done_functors gets and initializes the</span>
<span class="sd">        shared done dict used for this iteration</span>

<span class="sd">        The shared done dictionary does not correspond to individual</span>
<span class="sd">        agents but looks sharedly at all agents.</span>

<span class="sd">        this will be called after any updates to the simulator</span>
<span class="sd">        configuration during reset</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        DoneDict</span>
<span class="sd">            The DoneDict with functors used for this iteration</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">done_conditions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ref_sources</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">local_variable_store</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reference_store&#39;</span><span class="p">,</span> <span class="p">{}),</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reference_store</span><span class="p">]</span>
        <span class="n">param_sources</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">local_variable_store</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;shared&#39;</span><span class="p">,</span> <span class="p">{})]</span>
        <span class="k">for</span> <span class="n">done_functor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dones</span><span class="o">.</span><span class="n">shared</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">done_functor</span><span class="o">.</span><span class="n">create_functor_object</span><span class="p">(</span><span class="n">param_sources</span><span class="o">=</span><span class="n">param_sources</span><span class="p">,</span> <span class="n">ref_sources</span><span class="o">=</span><span class="n">ref_sources</span><span class="p">)</span>
            <span class="n">done_conditions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">DoneDict</span><span class="p">(</span><span class="n">processing_funcs</span><span class="o">=</span><span class="n">done_conditions</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_create_actions</span><span class="p">(</span><span class="n">agents</span><span class="p">,</span> <span class="n">observations</span><span class="o">=</span><span class="p">{},</span> <span class="n">rewards</span><span class="o">=</span><span class="p">{},</span> <span class="n">dones</span><span class="o">=</span><span class="p">{},</span> <span class="n">info</span><span class="o">=</span><span class="p">{}):</span>  <span class="c1"># pylint: disable=dangerous-default-value</span>
        <span class="k">for</span> <span class="n">agent_name</span><span class="p">,</span> <span class="n">agent_class</span> <span class="ow">in</span> <span class="n">agents</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">agent_class</span><span class="o">.</span><span class="n">create_next_action</span><span class="p">(</span>
                <span class="n">observations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">agent_name</span><span class="p">),</span> <span class="n">rewards</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">agent_name</span><span class="p">),</span> <span class="n">dones</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">agent_name</span><span class="p">),</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">agent_name</span><span class="p">)</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__create_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">space_getter</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gym</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        _create_space Create spaces for all agents by calling their glue objects</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        space_getter</span>
<span class="sd">            A function that takes a glue_obj: BaseAgentGlue and returns the space for creating this space</span>
<span class="sd">            For example    space_getter=lambda glue_obj: glue_obj.observation_space()</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            A space build from all the glues for each agent in this Environment</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># init our return Dict</span>
        <span class="n">return_space</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">Dict</span><span class="p">()</span>
        <span class="c1"># loop over all the agents and their glue_name_obj_pairs list</span>
        <span class="k">for</span> <span class="n">agent_id</span><span class="p">,</span> <span class="n">agent_class</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">tmp_space</span> <span class="o">=</span> <span class="n">agent_class</span><span class="o">.</span><span class="n">create_space</span><span class="p">(</span><span class="n">space_getter</span><span class="p">)</span>
            <span class="c1"># if this agent provided anything add it to the return space</span>
            <span class="k">if</span> <span class="n">tmp_space</span><span class="p">:</span>
                <span class="n">return_space</span><span class="o">.</span><span class="n">spaces</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_space</span>
        <span class="k">return</span> <span class="n">return_space</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">action_space</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gym</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Space</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        action_space The action space</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        typing.Dict[str,gym.spaces.tuple.Tuple]</span>
<span class="sd">            The action space</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalized_action_space</span>

    <span class="c1">############</span>
    <span class="c1"># Properties</span>
    <span class="c1">############</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">glue_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;[summary]</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[OrderedDict, None] -- [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">done_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;[summary]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Union[OrderedDict, None]</span>
<span class="sd">            [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_done_info</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">reward_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;[summary]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Union[OrderedDict, None]</span>
<span class="sd">            [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reward_info</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">observation_space</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gym</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Space</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        observation_space The observation space setup by the user</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        gym.spaces.dict.Dict</span>
<span class="sd">            The observation space</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalized_observation_space</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">state</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StateDict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        state of platform object.  Current state.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        StateDict</span>
<span class="sd">            the dict storing the curent state of environment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">simulator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseSimulator</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        simulator simulator instance</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        BaseSimulator</span>
<span class="sd">            The simulator instance in the base</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simulator</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">observation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        observation get the observation for the agents in this environment</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        OrderedDict</span>
<span class="sd">            the dict holding the observations for the agents</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">observation</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">episode_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the current episode parameter provider episode id</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int or None</span>
<span class="sd">            the episode id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode_id</span>

    <span class="k">def</span> <span class="nf">_get_platform_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">platform_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BasePlatform</span><span class="p">:</span>
        <span class="n">platform</span><span class="p">:</span> <span class="n">BasePlatform</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: ignore</span>
        <span class="k">for</span> <span class="n">plat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">sim_platforms</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">plat</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">platform_id</span><span class="p">:</span>
                <span class="n">platform</span> <span class="o">=</span> <span class="n">plat</span>

        <span class="k">if</span> <span class="n">platform</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">platform</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">BasePlatform</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">sim_platforms</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> glue could not find a platform named </span><span class="si">{</span><span class="n">platform_id</span><span class="si">}</span><span class="s2"> of class BasePlatform&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">platform</span>

    <span class="k">def</span> <span class="nf">__setup_state_history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">episode_history</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">deque</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">horizon</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">episode_state</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">step_state</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">post_process_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_id</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">episode</span><span class="p">,</span> <span class="n">policy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;easy accessor for calling post process trajectory</span>
<span class="sd">            correctly</span>

<span class="sd">        Arguments:</span>
<span class="sd">            agent_id {[type]} -- agent id</span>
<span class="sd">            batch {[type]} -- post processed Batch - be careful modifying</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span><span class="o">.</span><span class="n">post_process_trajectory</span><span class="p">(</span>
            <span class="n">agent_id</span><span class="p">,</span>
            <span class="n">episode</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">_state</span><span class="p">,</span>  <span class="c1"># pylint: disable=protected-access</span>
            <span class="n">batch</span><span class="p">,</span>
            <span class="n">episode</span><span class="p">,</span>
            <span class="n">policy</span><span class="p">,</span>
            <span class="n">episode</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">_reward_info</span>  <span class="c1"># pylint: disable=protected-access</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__sanity_check</span><span class="p">(</span><span class="n">space</span><span class="p">:</span> <span class="n">gym</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Space</span><span class="p">,</span> <span class="n">space_sample</span><span class="p">:</span> <span class="n">EnvSpaceUtil</span><span class="o">.</span><span class="n">sample_type</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sanity checks a space_sample against a space</span>
<span class="sd">        1. Check to ensure that the sample from the integration base</span>
<span class="sd">           Fall within the expected range of values.</span>

<span class="sd">        Note: space_sample and space expected to match up on</span>
<span class="sd">        Key level entries</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        space: gym.spaces.Space</span>
<span class="sd">            the space to check the sample against</span>
<span class="sd">        space_sample: EnvSpaceUtil.sample_type</span>
<span class="sd">            the sample to check if it is actually in the bounds of the space</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        OrderedDict:</span>
<span class="sd">            the scaled_observations</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">space</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">space_sample</span><span class="p">):</span>
            <span class="n">space</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">space_sample</span><span class="p">)</span>
            <span class="n">EnvSpaceUtil</span><span class="o">.</span><span class="n">deep_sanity_check_space_sample</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">space_sample</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_save_state_pickle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span> <span class="ne">ValueError</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;saves state for later debug</span>

<span class="sd">        Arguments:</span>
<span class="sd">            err {ValueError} -- Traceback for the error</span>

<span class="sd">        Raises:</span>
<span class="sd">            err: Customized error message to raise for the exception</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out_pickle</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;sanity_check_failure_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">)</span>
        <span class="n">p_dict</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">p_dict</span><span class="p">[</span><span class="s2">&quot;err&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>

        <span class="k">class</span> <span class="nc">NumpyArrayEncoder</span><span class="p">(</span><span class="n">JSONEncoder</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Encode the numpy types for json</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>  <span class="c1"># pylint: disable=arguments-differ</span>
                <span class="n">val</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>
                    <span class="n">obj</span><span class="p">,</span>
                    <span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">int_</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">intc</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">intp</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">):</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float_</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)):</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="p">)):</span>  <span class="c1"># This is the fix</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">):</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="s1">&#39;True&#39;</span> <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">True</span> <span class="k">else</span> <span class="s1">&#39;False&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">val</span>

        <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="n">input_ordered_dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">loads</span><span class="p">(</span><span class="n">dumps</span><span class="p">(</span><span class="n">input_ordered_dict</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NumpyArrayEncoder</span><span class="p">))</span>

        <span class="n">p_dict</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span>  <span class="c1"># type: ignore</span>
        <span class="n">p_dict</span><span class="p">[</span><span class="s2">&quot;observation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">observation</span>  <span class="c1"># type: ignore</span>
        <span class="n">p_dict</span><span class="p">[</span><span class="s2">&quot;dones&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_done_info</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="c1"># p_dict[&quot;env_config&quot;] = copy.deepcopy(self.env_config)  # type: ignore</span>
        <span class="n">p_dict</span><span class="p">[</span><span class="s2">&quot;step&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_episode_length</span><span class="p">)</span>

        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">p_dict</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_pickle</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error occurred: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2"> Saving sanity check failure output pickle to file: </span><span class="si">{</span><span class="n">out_pickle</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">seed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;generates environment seed through rllib</span>

<span class="sd">        Keyword Arguments:</span>
<span class="sd">            seed {[int]} -- seed to set environment with (default: {None})</span>

<span class="sd">        Returns:</span>
<span class="sd">            [int] -- [seed value]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;rng&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">seeding</span><span class="o">.</span><span class="n">np_random</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">seed</span><span class="p">]</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h3 id="corl.environment.multi_agent_env.ACT3MultiAgentEnv.action_space" class="doc doc-heading">
<code class="highlight language-python"><span class="n">action_space</span><span class="p">:</span> <span class="n">Space</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.action_space" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>action_space The action space</p>
<h5 id="corl.environment.multi_agent_env.ACT3MultiAgentEnv.action_space--returns">Returns<a class="headerlink" href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.action_space--returns" title="Permanent link">¤</a></h5>
<p>typing.Dict[str,gym.spaces.tuple.Tuple]
    The action space</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h3 id="corl.environment.multi_agent_env.ACT3MultiAgentEnv.done_info" class="doc doc-heading">
<code class="highlight language-python"><span class="n">done_info</span><span class="p">:</span> <span class="n">OrderedDict</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.done_info" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>[summary]</p>
<h5 id="corl.environment.multi_agent_env.ACT3MultiAgentEnv.done_info--returns">Returns<a class="headerlink" href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.done_info--returns" title="Permanent link">¤</a></h5>
<p>Union[OrderedDict, None]
    [description]</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h3 id="corl.environment.multi_agent_env.ACT3MultiAgentEnv.episode_id" class="doc doc-heading">
<code class="highlight language-python"><span class="n">episode_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.episode_id" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>get the current episode parameter provider episode id</p>
<h5 id="corl.environment.multi_agent_env.ACT3MultiAgentEnv.episode_id--returns">Returns<a class="headerlink" href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.episode_id--returns" title="Permanent link">¤</a></h5>
<p>int or None
    the episode id</p>
    </div>

  </div>




  <div class="doc doc-object doc-attribute">



<h3 id="corl.environment.multi_agent_env.ACT3MultiAgentEnv.get_validator" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_validator</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">corl</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">multi_agent_env</span><span class="o">.</span><span class="n">ACT3MultiAgentEnvValidator</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.get_validator" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Get the validator for this class.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h3 id="corl.environment.multi_agent_env.ACT3MultiAgentEnv.glue_info" class="doc doc-heading">
<code class="highlight language-python"><span class="n">glue_info</span><span class="p">:</span> <span class="n">OrderedDict</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.glue_info" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>[summary]</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>OrderedDict</code></td>
      <td><p>Union[OrderedDict, None] -- [description]</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h3 id="corl.environment.multi_agent_env.ACT3MultiAgentEnv.observation" class="doc doc-heading">
<code class="highlight language-python"><span class="n">observation</span><span class="p">:</span> <span class="n">OrderedDict</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.observation" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>observation get the observation for the agents in this environment</p>
<h5 id="corl.environment.multi_agent_env.ACT3MultiAgentEnv.observation--returns">Returns<a class="headerlink" href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.observation--returns" title="Permanent link">¤</a></h5>
<p>OrderedDict
    the dict holding the observations for the agents</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h3 id="corl.environment.multi_agent_env.ACT3MultiAgentEnv.observation_space" class="doc doc-heading">
<code class="highlight language-python"><span class="n">observation_space</span><span class="p">:</span> <span class="n">Space</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.observation_space" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>observation_space The observation space setup by the user</p>
<h5 id="corl.environment.multi_agent_env.ACT3MultiAgentEnv.observation_space--returns">Returns<a class="headerlink" href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.observation_space--returns" title="Permanent link">¤</a></h5>
<p>gym.spaces.dict.Dict
    The observation space</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h3 id="corl.environment.multi_agent_env.ACT3MultiAgentEnv.reward_info" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reward_info</span><span class="p">:</span> <span class="n">OrderedDict</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.reward_info" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>[summary]</p>
<h5 id="corl.environment.multi_agent_env.ACT3MultiAgentEnv.reward_info--returns">Returns<a class="headerlink" href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.reward_info--returns" title="Permanent link">¤</a></h5>
<p>Union[OrderedDict, None]
    [description]</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h3 id="corl.environment.multi_agent_env.ACT3MultiAgentEnv.simulator" class="doc doc-heading">
<code class="highlight language-python"><span class="n">simulator</span><span class="p">:</span> <span class="n">BaseSimulator</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.simulator" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>simulator simulator instance</p>
<h5 id="corl.environment.multi_agent_env.ACT3MultiAgentEnv.simulator--returns">Returns<a class="headerlink" href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.simulator--returns" title="Permanent link">¤</a></h5>
<p>BaseSimulator
    The simulator instance in the base</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h3 id="corl.environment.multi_agent_env.ACT3MultiAgentEnv.state" class="doc doc-heading">
<code class="highlight language-python"><span class="n">state</span><span class="p">:</span> <span class="n">StateDict</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.state" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>state of platform object.  Current state.</p>
<h5 id="corl.environment.multi_agent_env.ACT3MultiAgentEnv.state--returns">Returns<a class="headerlink" href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.state--returns" title="Permanent link">¤</a></h5>
<p>StateDict
    the dict storing the curent state of environment.</p>
    </div>

  </div>






  <div class="doc doc-object doc-method">



<h3 id="corl.environment.multi_agent_env.ACT3MultiAgentEnv.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.__init__" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p><strong>init</strong> initializes the rllib multi agent environment</p>
<h5 id="corl.environment.multi_agent_env.ACT3MultiAgentEnv.__init__--parameters">Parameters<a class="headerlink" href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.__init__--parameters" title="Permanent link">¤</a></h5>
<p>config : ray.rllib.env.env_context.EnvContext
    Passed in configuration for setting items up.
    Must have a 'simulator' key whose value is a BaseIntegrator type</p>

        <details class="quote">
          <summary>Source code in <code>corl/environment/multi_agent_env.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">EnvContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pylint: disable=too-many-statements, super-init-not-called</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    __init__ initializes the rllib multi agent environment</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    config : ray.rllib.env.env_context.EnvContext</span>
<span class="sd">        Passed in configuration for setting items up.</span>
<span class="sd">        Must have a &#39;simulator&#39; key whose value is a BaseIntegrator type</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">config_vars</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">config_vars</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span> <span class="n">ACT3MultiAgentEnvValidator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_validator</span><span class="p">(</span><span class="o">**</span><span class="n">config</span><span class="p">,</span> <span class="o">**</span><span class="n">config_vars</span><span class="p">)</span>

    <span class="c1"># Random numbers</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>

    <span class="c1"># setup default instance variables</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span> <span class="o">=</span> <span class="n">ObsBuffer</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_reward</span><span class="p">:</span> <span class="n">RewardDict</span> <span class="o">=</span> <span class="n">RewardDict</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_done</span><span class="p">:</span> <span class="n">DoneDict</span> <span class="o">=</span> <span class="n">DoneDict</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">:</span> <span class="n">OrderedDict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_episode_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_episode_id</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

    <span class="c1"># agent glue dict is a mapping from agent id to a dict with keys for the glue names</span>
    <span class="c1"># and values of the actual glue object</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_agent_glue_dict</span><span class="p">:</span> <span class="n">OrderedDict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_agent_glue_obs_export_behavior</span><span class="p">:</span> <span class="n">OrderedDict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

    <span class="c1"># Create the logger</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">ACT3MultiAgentEnv</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="c1"># Extra simulation init args</span>
    <span class="c1"># assign the new output_path with the worker index back to the config for the sim/integration output_path</span>
    <span class="n">extra_sim_init_args</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;output_path&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_path</span><span class="p">),</span>
        <span class="s2">&quot;worker_index&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">worker_index</span><span class="p">,</span>
        <span class="s2">&quot;vector_index&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">vector_index</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">vector_index</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="p">,</span> <span class="n">extra_sim_init_args</span><span class="p">[</span><span class="s2">&quot;agent_configs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env_creation</span><span class="o">.</span><span class="n">create_agent_sim_configs</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">agents</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">agent_platforms</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">simulator</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">platforms</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">epp_registry</span><span class="p">,</span>
        <span class="n">multiple_workers</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">num_workers</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">compute_lcm</span><span class="p">(</span><span class="n">values</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="n">lcm</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">denominator</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="n">lcm</span> <span class="o">=</span> <span class="n">lcm</span> <span class="o">//</span> <span class="n">math</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">lcm</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">denominator</span><span class="p">)</span> <span class="o">*</span> <span class="n">v</span><span class="o">.</span><span class="n">denominator</span>
        <span class="k">return</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">lcm</span>

    <span class="n">max_rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_agent_rate</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_agent_periods</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">agent_id</span><span class="p">:</span> <span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">agent</span><span class="o">.</span><span class="n">frame_rate</span><span class="p">)</span><span class="o">.</span><span class="n">limit_denominator</span><span class="p">(</span><span class="n">max_rate</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">agent_id</span><span class="p">,</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_agent_process_time</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">min</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sim_period</span> <span class="o">=</span> <span class="n">compute_lcm</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_agent_periods</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="n">extra_sim_init_args</span><span class="p">[</span><span class="s1">&#39;frame_rate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_period</span>

    <span class="k">for</span> <span class="n">agent_name</span><span class="p">,</span> <span class="n">platform</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">other_platforms</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">extra_sim_init_args</span><span class="p">[</span><span class="s2">&quot;agent_configs&quot;</span><span class="p">][</span><span class="n">agent_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;platform_config&quot;</span><span class="p">:</span> <span class="n">platform</span><span class="p">,</span>
            <span class="s2">&quot;parts_list&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">}</span>

    <span class="c1"># Debug logging</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;output_path : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Sample parameter provider</span>
    <span class="n">default_parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">epp</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">local_variable_store</span> <span class="o">=</span> <span class="n">flatten_dict</span><span class="o">.</span><span class="n">unflatten</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">default_parameters</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
    <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">fill_parameters</span><span class="p">(</span><span class="n">rng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">,</span> <span class="n">default_parameters</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Create the simulator for this gym environment</span>
    <span class="c1"># ----  oddity from other simulator bases HLP</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_simulator&quot;</span><span class="p">):</span>

        <span class="k">class</span> <span class="nc">SimulatorWrapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">simulator</span><span class="o">.</span><span class="n">type</span><span class="p">):</span>  <span class="c1"># type: ignore</span>
            <span class="sd">&quot;&quot;&quot;Wrapper that injects platforms/time into state dict&quot;&quot;&quot;</span>

            <span class="k">def</span> <span class="nf">_clear_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;sim_time&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">:</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">[</span><span class="s1">&#39;sim_time&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="s1">&#39;sim_platforms&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">:</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">[</span><span class="s1">&#39;sim_platforms&#39;</span><span class="p">]</span>

            <span class="k">def</span> <span class="nf">_inject_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">StateDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StateDict</span><span class="p">:</span>
                <span class="sd">&quot;&quot;&quot;Ensures that time/platforms exists in state&quot;&quot;&quot;</span>
                <span class="k">if</span> <span class="s1">&#39;sim_time&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
                    <span class="n">state</span><span class="p">[</span><span class="s1">&#39;sim_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span>

                <span class="k">if</span> <span class="s1">&#39;sim_platforms&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
                    <span class="n">state</span><span class="p">[</span><span class="s1">&#39;sim_platforms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">platforms</span>

                <span class="k">return</span> <span class="n">state</span>

            <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StateDict</span><span class="p">:</span>
                <span class="sd">&quot;&quot;&quot;Steps the simulation - injects data into StateDict&quot;&quot;&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_clear_data</span><span class="p">()</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inject_data</span><span class="p">(</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">step</span><span class="p">())</span>

            <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StateDict</span><span class="p">:</span>
                <span class="sd">&quot;&quot;&quot;Resets the simulation - injects data into StateDict&quot;&quot;&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_clear_data</span><span class="p">()</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inject_data</span><span class="p">(</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>

        <span class="n">simulator_factory</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">simulator</span><span class="p">)</span>
        <span class="n">simulator_factory</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">SimulatorWrapper</span>  <span class="c1"># type: ignore</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_simulator</span><span class="p">:</span> <span class="n">BaseSimulator</span> <span class="o">=</span> <span class="n">simulator_factory</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="o">**</span><span class="n">extra_sim_init_args</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_reset_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reset_simulator</span><span class="p">(</span><span class="n">extra_sim_init_args</span><span class="p">[</span><span class="s2">&quot;agent_configs&quot;</span><span class="p">])</span>

    <span class="c1"># Make the glue objects from the glue mapping now that we have a simulator created</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_make_glues</span><span class="p">()</span>

    <span class="c1"># create dictionary to hold done history</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__setup_state_history</span><span class="p">()</span>

    <span class="c1"># Create the observation and action space now that we have the glue</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_observation_space</span><span class="p">:</span> <span class="n">gym</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__create_space</span><span class="p">(</span><span class="n">space_getter</span><span class="o">=</span><span class="k">lambda</span> <span class="n">glue_obj</span><span class="p">:</span> <span class="n">glue_obj</span><span class="o">.</span><span class="n">observation_space</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_action_space</span><span class="p">:</span> <span class="n">gym</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__create_space</span><span class="p">(</span><span class="n">space_getter</span><span class="o">=</span><span class="k">lambda</span> <span class="n">glue_obj</span><span class="p">:</span> <span class="n">glue_obj</span><span class="o">.</span><span class="n">action_space</span><span class="p">())</span>
    <span class="n">gym_space_sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_action_space</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_normalized_observation_space</span><span class="p">:</span> <span class="n">gym</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__create_space</span><span class="p">(</span>
        <span class="n">space_getter</span><span class="o">=</span><span class="k">lambda</span> <span class="n">glue_obj</span><span class="p">:</span> <span class="n">glue_obj</span><span class="o">.</span><span class="n">normalized_observation_space</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">glue_obj</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">training_export_behavior</span> <span class="o">==</span> <span class="n">TrainingExportBehavior</span><span class="o">.</span><span class="n">INCLUDE</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_normalized_action_space</span><span class="p">:</span> <span class="n">gym</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">Dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__create_space</span><span class="p">(</span>
        <span class="n">space_getter</span><span class="o">=</span><span class="k">lambda</span> <span class="n">glue_obj</span><span class="p">:</span> <span class="n">glue_obj</span><span class="o">.</span><span class="n">normalized_action_space</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">gym_space_sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_normalized_action_space</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_observation_units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__create_space</span><span class="p">(</span>
        <span class="n">space_getter</span><span class="o">=</span><span class="k">lambda</span> <span class="n">glue_obj</span><span class="p">:</span> <span class="n">glue_obj</span><span class="o">.</span><span class="n">observation_units</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">glue_obj</span><span class="p">,</span> <span class="s2">&quot;observation_units&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_shared_done</span><span class="p">:</span> <span class="n">DoneDict</span> <span class="o">=</span> <span class="n">DoneDict</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_done_info</span><span class="p">:</span> <span class="n">OrderedDict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_reward_info</span><span class="p">:</span> <span class="n">OrderedDict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_episode_init_params</span><span class="p">:</span> <span class="nb">dict</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">done_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_agent_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_action_space</span><span class="o">.</span><span class="n">spaces</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_skip_action</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="corl.environment.multi_agent_env.ACT3MultiAgentEnv.create_training_observations" class="doc doc-heading">
<code class="highlight language-python"><span class="n">create_training_observations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alive_agents</span><span class="p">,</span> <span class="n">observations</span><span class="p">)</span></code>


<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.create_training_observations" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Filters and normalizes observations (the sample of the space) using the glue normalize functions.</p>
<h5 id="corl.environment.multi_agent_env.ACT3MultiAgentEnv.create_training_observations--parameters">Parameters<a class="headerlink" href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.create_training_observations--parameters" title="Permanent link">¤</a></h5>
<div class="admonition alive_agents">
<p class="admonition-title">Alive_agents</p>
<p>The agents that are still alive</p>
</div>
<div class="admonition observations">
<p class="admonition-title">Observations</p>
<p>The observations</p>
</div>
<h5 id="corl.environment.multi_agent_env.ACT3MultiAgentEnv.create_training_observations--returns">Returns<a class="headerlink" href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.create_training_observations--returns" title="Permanent link">¤</a></h5>
<div class="admonition ordereddict">
<p class="admonition-title">Ordereddict</p>
<p>the filtered/normalized observation samples</p>
</div>

        <details class="quote">
          <summary>Source code in <code>corl/environment/multi_agent_env.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">create_training_observations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alive_agents</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                                 <span class="n">observations</span><span class="p">:</span> <span class="n">ObsBuffer</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="n">OrderedDict</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Filters and normalizes observations (the sample of the space) using the glue normalize functions.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    alive_agents:</span>
<span class="sd">        The agents that are still alive</span>
<span class="sd">    observations:</span>
<span class="sd">        The observations</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    OrderedDict:</span>
<span class="sd">        the filtered/normalized observation samples</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">this_steps_obs</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">agent_id</span> <span class="ow">in</span> <span class="n">alive_agents</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">agent_id</span> <span class="ow">in</span> <span class="n">observations</span><span class="o">.</span><span class="n">observation</span><span class="p">:</span>
            <span class="n">this_steps_obs</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">observations</span><span class="o">.</span><span class="n">observation</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">agent_id</span> <span class="ow">in</span> <span class="n">observations</span><span class="o">.</span><span class="n">next_observation</span><span class="p">:</span>
            <span class="n">this_steps_obs</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">observations</span><span class="o">.</span><span class="n">next_observation</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;ERROR: create_training_observations tried to retrieve obs for this training step&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; but </span><span class="si">{</span><span class="n">agent_id</span><span class="si">=}</span><span class="s2"> was not able to be found in either the current obs data or the &quot;</span>
                <span class="s2">&quot; obs from the previous timestep as a fallback&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">do_export</span><span class="p">(</span><span class="n">agent_id</span><span class="p">,</span> <span class="n">obs_name</span><span class="p">,</span> <span class="n">_obs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">agent_id</span> <span class="ow">in</span> <span class="n">alive_agents</span><span class="p">:</span>
            <span class="n">glue_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span><span class="o">.</span><span class="n">get_glue</span><span class="p">(</span><span class="n">obs_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">glue_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">glue_obj</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">training_export_behavior</span> <span class="o">==</span> <span class="n">TrainingExportBehavior</span><span class="o">.</span><span class="n">INCLUDE</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="n">filtered_observations</span> <span class="o">=</span> <span class="n">filter_observations</span><span class="p">(</span><span class="n">this_steps_obs</span><span class="p">,</span> <span class="n">do_export</span><span class="p">)</span>

    <span class="n">normalized_observations</span> <span class="o">=</span> <span class="n">mutate_observations</span><span class="p">(</span>
        <span class="n">filtered_observations</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">agent_id</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
        <span class="n">obs_name</span><span class="p">,</span>
        <span class="n">obs</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span><span class="o">.</span><span class="n">normalize_observation</span><span class="p">(</span><span class="n">obs_name</span><span class="p">,</span> <span class="n">obs</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">normalized_observations</span><span class="p">,</span> <span class="n">filtered_observations</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="corl.environment.multi_agent_env.ACT3MultiAgentEnv.post_process_trajectory" class="doc doc-heading">
<code class="highlight language-python"><span class="n">post_process_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_id</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">episode</span><span class="p">,</span> <span class="n">policy</span><span class="p">)</span></code>


<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.post_process_trajectory" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>easy accessor for calling post process trajectory
    correctly</p>

        <details class="quote">
          <summary>Source code in <code>corl/environment/multi_agent_env.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">post_process_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_id</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">episode</span><span class="p">,</span> <span class="n">policy</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;easy accessor for calling post process trajectory</span>
<span class="sd">        correctly</span>

<span class="sd">    Arguments:</span>
<span class="sd">        agent_id {[type]} -- agent id</span>
<span class="sd">        batch {[type]} -- post processed Batch - be careful modifying</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span><span class="o">.</span><span class="n">post_process_trajectory</span><span class="p">(</span>
        <span class="n">agent_id</span><span class="p">,</span>
        <span class="n">episode</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">_state</span><span class="p">,</span>  <span class="c1"># pylint: disable=protected-access</span>
        <span class="n">batch</span><span class="p">,</span>
        <span class="n">episode</span><span class="p">,</span>
        <span class="n">policy</span><span class="p">,</span>
        <span class="n">episode</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">_reward_info</span>  <span class="c1"># pylint: disable=protected-access</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="corl.environment.multi_agent_env.ACT3MultiAgentEnv.reset" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.reset" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Resets the env and returns observations from ready agents.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td></td>
      <td><p>New observations for each ready agent.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">ray.rllib.env.multi_agent_env</span> <span class="kn">import</span> <span class="n">MultiAgentEnv</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">MyMultiAgentEnv</span><span class="p">(</span><span class="n">MultiAgentEnv</span><span class="p">):</span>
<span class="o">...</span>     <span class="c1"># Define your env here.</span>
<span class="o">...</span>     <span class="o">...</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">env</span> <span class="o">=</span> <span class="n">MyMultiAgentEnv</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">obs</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
<span class="p">{</span>
    <span class="s2">&quot;car_0&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">2.4</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">],</span>
    <span class="s2">&quot;car_1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">3.4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.2</span><span class="p">],</span>
    <span class="s2">&quot;traffic_light_1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="p">}</span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>corl/environment/multi_agent_env.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="c1"># Sample parameter provider</span>
    <span class="n">current_parameters</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">epp</span><span class="o">.</span><span class="n">get_params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">local_variable_store</span> <span class="o">=</span> <span class="n">flatten_dict</span><span class="o">.</span><span class="n">unflatten</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">current_parameters</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
    <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">fill_parameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>

    <span class="c1"># 3. Reset the Done and Reward dictionaries for the next iteration</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_make_rewards</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_make_dones</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_shared_done</span><span class="p">:</span> <span class="n">DoneDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_shared_dones</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_reward</span><span class="p">:</span> <span class="n">RewardDict</span> <span class="o">=</span> <span class="n">RewardDict</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_done</span><span class="p">:</span> <span class="n">DoneDict</span> <span class="o">=</span> <span class="n">DoneDict</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_done_info</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">set_default_done_reward</span><span class="p">()</span>
    <span class="c1"># 4. Reset the simulation/integration</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim_reset_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reset_simulator</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_episode_length</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_agent_process_time</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="c1">#####################################################################</span>
    <span class="c1"># Make glue sections - Given the state of the simulation we need to</span>
    <span class="c1"># update the platform interfaces.</span>
    <span class="c1">#####################################################################</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_make_glues</span><span class="p">()</span>

    <span class="c1">#####################################################################</span>
    <span class="c1"># get observations</span>
    <span class="c1"># For each configured agent read the observations/measurements</span>
    <span class="c1">#####################################################################</span>
    <span class="n">agent_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">next_observation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_observations_from_glues</span><span class="p">(</span><span class="n">agent_list</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">update_obs_pointer</span><span class="p">()</span>
    <span class="c1"># The following loop guarantees that durring training that the glue</span>
    <span class="c1"># states start with valid values for rates. The number of recommended</span>
    <span class="c1"># steps for sim is at least equal to the depth of the rate observation</span>
    <span class="c1"># tree (ex: speed - 2, acceleration - 3, jerk - 4) - recommend defaulting</span>
    <span class="c1"># to 4 as we do not go higher thank jerk</span>
    <span class="c1"># 1 step is always added for the inital obs in reset</span>
    <span class="n">warmup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sim_warmup_steps</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">warmup</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simulator</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">next_observation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_observations_from_glues</span><span class="p">(</span><span class="n">agent_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">update_obs_pointer</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">__setup_state_history</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">platform</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">sim_platforms</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">step_state</span><span class="p">[</span><span class="n">platform</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">episode_history</span><span class="p">[</span><span class="n">platform</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">episode_state</span><span class="p">[</span><span class="n">platform</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

    <span class="c1"># Sanity Checks and Scale</span>
    <span class="c1"># The current deep sanity check will not raise error if values are from sample are different from space during reset</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">deep_sanity_check</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__sanity_check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_space</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">observation</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_state_pickle</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observation_space</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">observation</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;obs not contained in obs space&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_create_actions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">observation</span><span class="p">)</span>

    <span class="c1">#####################################################################</span>
    <span class="c1"># return results to RLLIB - Note that RLLIB does not do a recursive</span>
    <span class="c1"># isinstance call and as such need to make sure items are</span>
    <span class="c1"># OrderedDicts</span>
    <span class="c1">#####################################################################</span>
    <span class="n">trainable_observations</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_training_observations</span><span class="p">(</span><span class="n">agent_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">trainable_observations</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="corl.environment.multi_agent_env.ACT3MultiAgentEnv.seed" class="doc doc-heading">
<code class="highlight language-python"><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.seed" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>generates environment seed through rllib</p>

<p><strong>Keyword arguments:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>seed</code></td>
        <td><code>{[int]} -- seed to set environment with (default</code></td>
        <td><p>{None})</p></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td></td>
      <td><p>[int] -- [seed value]</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>corl/environment/multi_agent_env.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">seed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;generates environment seed through rllib</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">        seed {[int]} -- seed to set environment with (default: {None})</span>

<span class="sd">    Returns:</span>
<span class="sd">        [int] -- [seed value]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;rng&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">seeding</span><span class="o">.</span><span class="n">np_random</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">seed</span><span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="corl.environment.multi_agent_env.ACT3MultiAgentEnv.set_default_done_reward" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_default_done_reward</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.set_default_done_reward" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Populate the done/rewards with default values</p>

        <details class="quote">
          <summary>Source code in <code>corl/environment/multi_agent_env.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">set_default_done_reward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Populate the done/rewards with default values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>  <span class="c1"># pylint: disable=C0201</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_done</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reward</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># pylint: disable=protected-access</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shared_done</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_done</span><span class="p">[</span><span class="n">DoneFuncBase</span><span class="o">.</span><span class="n">_ALL</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># pylint: disable=protected-access</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_shared_done</span><span class="p">[</span><span class="n">DoneFuncBase</span><span class="o">.</span><span class="n">_ALL</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># pylint: disable=protected-access</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="corl.environment.multi_agent_env.ACT3MultiAgentEnv.step" class="doc doc-heading">
<code class="highlight language-python"><span class="n">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_dict</span><span class="p">)</span></code>


<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnv.step" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Returns observations from ready agents.</p>
<p>The returns are dicts mapping from agent_id strings to values. The
number of agents in the env can vary over time.</p>
<div class="codehilite"><pre><span></span><code><span class="nv">obs</span><span class="w"> </span><span class="ss">(</span><span class="nv">StateDict</span><span class="ss">)</span>:<span class="w"> </span><span class="nv">New</span><span class="w"> </span><span class="nv">observations</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">each</span><span class="w"> </span><span class="nv">ready</span><span class="w"> </span><span class="nv">agent</span>.<span class="w"></span>
<span class="w">    </span><span class="nv">episode</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">just</span><span class="w"> </span><span class="nv">started</span>,<span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="nv">will</span><span class="w"> </span><span class="nv">be</span><span class="w"> </span><span class="nv">None</span>.<span class="w"></span>
<span class="nv">dones</span><span class="w"> </span><span class="ss">(</span><span class="nv">StateDict</span><span class="ss">)</span>:<span class="w"> </span><span class="nv">Done</span><span class="w"> </span><span class="nv">values</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">each</span><span class="w"> </span><span class="nv">ready</span><span class="w"> </span><span class="nv">agent</span>.<span class="w"> </span><span class="nv">The</span><span class="w"></span>
<span class="w">    </span><span class="nv">special</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="s2">&quot;__all__&quot;</span><span class="w"> </span><span class="ss">(</span><span class="nv">required</span><span class="ss">)</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">used</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">indicate</span><span class="w"> </span><span class="nv">env</span><span class="w"></span>
<span class="w">    </span><span class="nv">termination</span>.<span class="w"></span>
<span class="nv">infos</span><span class="w"> </span><span class="ss">(</span><span class="nv">StateDict</span><span class="ss">)</span>:<span class="w"> </span><span class="nv">Optional</span><span class="w"> </span><span class="nv">info</span><span class="w"> </span><span class="nv">values</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">each</span><span class="w"> </span><span class="nv">agent</span><span class="w"> </span><span class="nv">id</span>.<span class="w"></span>
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>corl/environment/multi_agent_env.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="n">OrderedDict</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">]:</span>
    <span class="c1"># pylint: disable=R0912, R0914, R0915</span>
    <span class="sd">&quot;&quot;&quot;Returns observations from ready agents.</span>

<span class="sd">    The returns are dicts mapping from agent_id strings to values. The</span>
<span class="sd">    number of agents in the env can vary over time.</span>

<span class="sd">        obs (StateDict): New observations for each ready agent.</span>
<span class="sd">            episode is just started, the value will be None.</span>
<span class="sd">        dones (StateDict): Done values for each ready agent. The</span>
<span class="sd">            special key &quot;__all__&quot; (required) is used to indicate env</span>
<span class="sd">            termination.</span>
<span class="sd">        infos (StateDict): Optional info values for each agent id.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_episode_length</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">operable_agents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_operable_agents</span><span class="p">()</span>

    <span class="c1"># look to add this bugsplat, but this check won&#39;t work for multi fps</span>
    <span class="c1"># if set(operable_agents.keys()) != set(action_dict.keys()):</span>
    <span class="c1">#     raise RuntimeError(&quot;Operable_agents and action_dict keys differ!&quot;</span>
    <span class="c1">#                        f&quot;operable={set(operable_agents.keys())} != act={set(action_dict.keys())} &quot;</span>
    <span class="c1">#                        &quot;If this happens that means either your platform is not setting non operable correctly&quot;</span>
    <span class="c1">#                        &quot; (if extra keys are in operable set) or you do not have a done condition covering &quot;</span>
    <span class="c1">#                        &quot;a condition where your platform is going non operable. (if extra keys in act)&quot;)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_action</span><span class="p">:</span>
        <span class="n">raw_action_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">raw_action_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__apply_action</span><span class="p">(</span><span class="n">operable_agents</span><span class="p">,</span> <span class="n">action_dict</span><span class="p">)</span>

    <span class="c1"># Save current action for future debugging</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action_dict</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simulator</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_state_pickle</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>

    <span class="c1"># MTB - Changing to not replace operable_agents variable</span>
    <span class="c1">#       We calculate observations on agents operable after sim step</span>
    <span class="c1">#       - This is done because otherwise observations would be invalid</span>
    <span class="c1">#       Calculate Dones/Rewards on agents operable before sim step</span>
    <span class="c1">#       - This is done because if an agent &quot;dies&quot; it needs to have a final done calculated</span>
    <span class="n">operable_agents_after_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_operable_agents</span><span class="p">()</span>

    <span class="c1">#####################################################################</span>
    <span class="c1"># get next observations - For each configured platform read the</span>
    <span class="c1"># observations/measurements</span>
    <span class="c1">#####################################################################</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">next_observation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_observations_from_glues</span><span class="p">(</span><span class="n">operable_agents_after_step</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__get_info_from_glue</span><span class="p">(</span><span class="n">operable_agents_after_step</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="c1">#####################################################################</span>
    <span class="c1"># Process the done conditions</span>
    <span class="c1"># 1. Reset the rewards from the last step</span>
    <span class="c1"># 2. loops over all agents and processes the reward conditions per</span>
    <span class="c1">#    agent</span>
    <span class="c1">#####################################################################</span>

    <span class="n">agents_done</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_done_from_agents</span><span class="p">(</span><span class="n">operable_agents</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">raw_action_dict</span><span class="o">=</span><span class="n">raw_action_dict</span><span class="p">)</span>

    <span class="n">expected_done_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">operable_agents</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">expected_done_keys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;__all__&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">agents_done</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">!=</span> <span class="n">expected_done_keys</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;Local dones do not match expected keys.  Received &quot;</span><span class="si">{</span><span class="n">agents_done</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s1">&quot;.  Expected &quot;</span><span class="si">{</span><span class="n">expected_done_keys</span><span class="si">}</span><span class="s1">&quot;.&#39;</span>
        <span class="p">)</span>

    <span class="c1"># compute if done all</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">agents_done</span><span class="p">[</span><span class="s1">&#39;__all__&#39;</span><span class="p">]:</span>
        <span class="n">agent_dones</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">agents_done</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;__all__&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">end_episode_on_first_agent_done</span><span class="p">:</span>
            <span class="n">agents_done</span><span class="p">[</span><span class="s1">&#39;__all__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">agent_dones</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">agents_done</span><span class="p">[</span><span class="s1">&#39;__all__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">agent_dones</span><span class="p">)</span>

    <span class="n">shared_dones</span><span class="p">,</span> <span class="n">shared_done_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shared_done</span><span class="p">(</span>
        <span class="n">observation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">observation</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="n">raw_action_dict</span><span class="p">,</span>
        <span class="n">next_observation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">next_observation</span><span class="p">,</span>
        <span class="n">next_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">,</span>
        <span class="n">observation_space</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_space</span><span class="p">,</span>
        <span class="n">observation_units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_units</span><span class="p">,</span>
        <span class="n">local_dones</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">agents_done</span><span class="p">),</span>
        <span class="n">local_done_info</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_done_info</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">shared_dones</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">shared_dones</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">!=</span> <span class="n">expected_done_keys</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Shared dones do not match expected keys.  Received &quot;</span><span class="si">{</span><span class="n">shared_dones</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s1">&quot;.  Expected &quot;</span><span class="si">{</span><span class="n">expected_done_keys</span><span class="si">}</span><span class="s1">&quot;.&#39;</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">expected_done_keys</span><span class="p">:</span>
            <span class="n">agents_done</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">|=</span> <span class="n">shared_dones</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">assert</span> <span class="n">shared_done_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="n">local_done_info_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_done_info</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">shared_done_info_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">shared_done_info</span><span class="p">)</span>
    <span class="n">common_keys</span> <span class="o">=</span> <span class="n">local_done_info_keys</span> <span class="o">&amp;</span> <span class="n">shared_done_info_keys</span>
    <span class="k">if</span> <span class="n">common_keys</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Dones have common names: &quot;</span><span class="si">{</span><span class="n">common_keys</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">done_name</span><span class="p">,</span> <span class="n">done_keys</span> <span class="ow">in</span> <span class="n">shared_done_info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">agent_name</span><span class="p">,</span> <span class="n">done_status</span> <span class="ow">in</span> <span class="n">done_keys</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_done_info</span><span class="p">[</span><span class="n">agent_name</span><span class="p">][</span><span class="n">done_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="p">[</span><span class="n">agent_name</span><span class="p">]</span><span class="o">.</span><span class="n">platform_name</span><span class="p">,</span> <span class="n">done_status</span><span class="p">)])</span>

    <span class="c1"># compute if done all</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">agents_done</span><span class="p">[</span><span class="s1">&#39;__all__&#39;</span><span class="p">]:</span>
        <span class="n">agent_dones</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">agents_done</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;__all__&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">end_episode_on_first_agent_done</span><span class="p">:</span>
            <span class="n">agents_done</span><span class="p">[</span><span class="s1">&#39;__all__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">agent_dones</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">agents_done</span><span class="p">[</span><span class="s1">&#39;__all__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">agent_dones</span><span class="p">)</span>

    <span class="c1"># Tell the simulator to mark the episode complete</span>
    <span class="k">if</span> <span class="n">agents_done</span><span class="p">[</span><span class="s1">&#39;__all__&#39;</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_simulator</span><span class="o">.</span><span class="n">mark_episode_done</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_done_info</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">episode_state</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_reward</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">agents_done</span><span class="p">[</span><span class="s1">&#39;__all__&#39;</span><span class="p">]:</span>
        <span class="n">agents_to_process_this_timestep</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">operable_agents</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="k">def</span> <span class="nf">do_process_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_id</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="n">frame_rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent_periods</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span><span class="o">.</span><span class="n">numerator</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent_periods</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span><span class="o">.</span><span class="n">denominator</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">sim_time</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent_process_time</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span> <span class="o">+</span> <span class="n">frame_rate</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">timestep_epsilon</span>

        <span class="n">agents_to_process_this_timestep</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">do_process_agent</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span> <span class="n">operable_agents</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

    <span class="k">for</span> <span class="n">agent_id</span> <span class="ow">in</span> <span class="n">agents_to_process_this_timestep</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_agent_process_time</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">sim_time</span>

    <span class="n">reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_reward_from_agents</span><span class="p">(</span><span class="n">agents_to_process_this_timestep</span><span class="p">,</span> <span class="n">raw_action_dict</span><span class="o">=</span><span class="n">raw_action_dict</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_simulator</span><span class="o">.</span><span class="n">save_episode_information</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">done_info</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reward_info</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">observation</span><span class="p">)</span>
    <span class="c1"># copy over observation from next to previous - There is no real reason to deep</span>
    <span class="c1"># copy here. The process of getting a new observation from the glue copies. All</span>
    <span class="c1"># we need to do is maintain the order of two buffers!!!.</span>
    <span class="c1"># Tested with: They are different and decreasing as expected</span>
    <span class="c1">#   print(f&quot;C: {self._obs_buffer.observation[&#39;blue0&#39;][&#39;ObserveSensor_Sensor_Fuel&#39;]}&quot;)</span>
    <span class="c1">#   print(f&quot;N: {self._obs_buffer.next_observation[&#39;blue0&#39;][&#39;ObserveSensor_Sensor_Fuel&#39;]}&quot;)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">update_obs_pointer</span><span class="p">()</span>
    <span class="c1"># Sanity checks and Scale - ensure run first time and run only every N times...</span>
    <span class="c1"># Same as RLLIB - This can add a bit of time as we are exploring complex dictionaries</span>
    <span class="c1"># default to every time if not specified... Once the limits are good we it is</span>
    <span class="c1"># recommended to increase this for training</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">deep_sanity_check</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode_length</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sanity_check_obs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__sanity_check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_space</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">observation</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_save_state_pickle</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observation_space</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span><span class="o">.</span><span class="n">observation</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;obs not contained in obs space&#39;</span><span class="p">)</span>

    <span class="n">complete_trainable_observations</span><span class="p">,</span> <span class="n">complete_unnormalized_observations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_training_observations</span><span class="p">(</span>
        <span class="n">operable_agents</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obs_buffer</span>
    <span class="p">)</span>
    <span class="n">trainable_observations</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">agent_id</span> <span class="ow">in</span> <span class="n">agents_to_process_this_timestep</span><span class="p">:</span>
        <span class="n">trainable_observations</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">complete_trainable_observations</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span>

    <span class="n">trainable_rewards</span> <span class="o">=</span> <span class="n">get_dictionary_subset</span><span class="p">(</span><span class="n">reward</span><span class="p">,</span> <span class="n">agents_to_process_this_timestep</span><span class="p">)</span>
    <span class="n">trainable_dones</span> <span class="o">=</span> <span class="n">get_dictionary_subset</span><span class="p">(</span><span class="n">agents_done</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;__all__&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">agents_to_process_this_timestep</span><span class="p">)</span>
    <span class="n">trainable_info</span> <span class="o">=</span> <span class="n">get_dictionary_subset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">,</span> <span class="n">agents_to_process_this_timestep</span><span class="p">)</span>

    <span class="c1"># add platform obs and env data to trainable_info (for use by custom policies)</span>
    <span class="k">for</span> <span class="n">agent_id</span> <span class="ow">in</span> <span class="n">agents_to_process_this_timestep</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">agent_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">trainable_info</span><span class="p">:</span>
            <span class="n">trainable_info</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">trainable_info</span><span class="p">[</span><span class="n">agent_id</span><span class="p">][</span><span class="s1">&#39;env&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;sim_period&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_period</span><span class="p">}</span>
        <span class="n">trainable_info</span><span class="p">[</span><span class="n">agent_id</span><span class="p">][</span><span class="s1">&#39;platform_obs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">plat_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span><span class="o">.</span><span class="n">platform_name</span>
        <span class="k">for</span> <span class="n">platform_agent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="p">[</span><span class="n">platform_agent</span><span class="p">]</span><span class="o">.</span><span class="n">platform_name</span> <span class="o">==</span> <span class="n">plat_name</span><span class="p">:</span>
                <span class="n">trainable_info</span><span class="p">[</span><span class="n">agent_id</span><span class="p">][</span><span class="s1">&#39;platform_obs&#39;</span><span class="p">][</span><span class="n">platform_agent</span><span class="p">]</span> <span class="o">=</span> <span class="n">complete_unnormalized_observations</span><span class="p">[</span><span class="n">platform_agent</span><span class="p">]</span>

    <span class="c1"># if not done all, delete any platforms from simulation that are done, so they don&#39;t interfere</span>
    <span class="n">platforms_deleted</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">agents_done</span><span class="p">[</span><span class="s1">&#39;__all__&#39;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">agent_key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">agents_done</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">agent_key</span> <span class="o">!=</span> <span class="s1">&#39;__all__&#39;</span> <span class="ow">and</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">plat_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="p">[</span><span class="n">agent_key</span><span class="p">]</span><span class="o">.</span><span class="n">platform_name</span>
                <span class="k">if</span> <span class="n">plat_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">platforms_deleted</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">simulator</span><span class="o">.</span><span class="n">delete_platform</span><span class="p">(</span><span class="n">plat_name</span><span class="p">)</span>
                    <span class="n">platforms_deleted</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">plat_name</span><span class="p">)</span>

    <span class="c1"># if a platform has been deleted, we need to make sure that all agents on that platform</span>
    <span class="c1"># are also done</span>
    <span class="k">for</span> <span class="n">agent_key</span> <span class="ow">in</span> <span class="n">trainable_dones</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">agent_key</span> <span class="o">==</span> <span class="s1">&#39;__all__&#39;</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">plat_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_dict</span><span class="p">[</span><span class="n">agent_key</span><span class="p">]</span><span class="o">.</span><span class="n">platform_name</span>
        <span class="k">if</span> <span class="n">plat_name</span> <span class="ow">in</span> <span class="n">platforms_deleted</span><span class="p">:</span>
            <span class="n">trainable_dones</span><span class="p">[</span><span class="n">agent_key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1">#####################################################################</span>
    <span class="c1"># return results to RLLIB - Note that RLLIB does not do a recursive</span>
    <span class="c1"># isinstance call and as such need to make sure items are</span>
    <span class="c1"># OrderedDicts</span>
    <span class="c1">#####################################################################</span>
    <span class="k">return</span> <span class="n">trainable_observations</span><span class="p">,</span> <span class="n">trainable_rewards</span><span class="p">,</span> <span class="n">trainable_dones</span><span class="p">,</span> <span class="n">trainable_info</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h2 id="corl.environment.multi_agent_env.ACT3MultiAgentEnvEppParameters" class="doc doc-heading">
        <code>
ACT3MultiAgentEnvEppParameters            (<span title="pydantic.main.BaseModel">BaseModel</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-model"><code>pydantic-model</code></small>
  </span>

<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvEppParameters" class="headerlink" title="Permanent link">¤</a></h2>

    <div class="doc doc-contents ">

      <div class="admonition world">
<p class="admonition-title">typing.Dict[str, typing.Dict[str, typing.Any]] = {}</p>
<p>keys: done name, parameter name</p>
</div>
<div class="admonition task">
<p class="admonition-title">typing.Dict[str, typing.Dict[str, typing.Dict[str, typing.Any]]] = {}</p>
<p>keys: agent name, done name, parameter name</p>
</div>
<div class="admonition shared">
<p class="admonition-title">typing.Dict[str, typing.Dict[str, typing.Any]] = {}</p>
<p>keys: done name, parameter name</p>
</div>
<div class="admonition reference_store">
<p class="admonition-title">typing.Dict[str, typing.Any] = {}</p>
<p>keys: reference name</p>
</div>
<div class="admonition simulator_reset">
<p class="admonition-title">typing.Dict[str, typing.Any] = {}</p>
<p>keys: whatever the simulator wants, but it needs to be kwargs to simulator reset</p>
</div>

        <details class="quote">
          <summary>Source code in <code>corl/environment/multi_agent_env.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ACT3MultiAgentEnvEppParameters</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    world: typing.Dict[str, typing.Dict[str, typing.Any]] = {}</span>
<span class="sd">        keys: done name, parameter name</span>

<span class="sd">    task: typing.Dict[str, typing.Dict[str, typing.Dict[str, typing.Any]]] = {}</span>
<span class="sd">        keys: agent name, done name, parameter name</span>

<span class="sd">    shared: typing.Dict[str, typing.Dict[str, typing.Any]] = {}</span>
<span class="sd">        keys: done name, parameter name</span>

<span class="sd">    reference_store: typing.Dict[str, typing.Any] = {}</span>
<span class="sd">        keys: reference name</span>

<span class="sd">    simulator_reset: typing.Dict[str, typing.Any] = {}</span>
<span class="sd">        keys: whatever the simulator wants, but it needs to be kwargs to simulator reset</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">world</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">task</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">shared</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">reference_store</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">simulator_reset</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_validate_leaves_are_parameters</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">_key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">ACT3MultiAgentEnvEppParameters</span><span class="o">.</span><span class="n">_validate_leaves_are_parameters</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="si">}</span><span class="s2"> (required type: </span><span class="si">{</span><span class="n">Parameter</span><span class="o">.</span><span class="vm">__qualname__</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s1">&#39;world&#39;</span><span class="p">,</span> <span class="s1">&#39;task&#39;</span><span class="p">,</span> <span class="s1">&#39;shared&#39;</span><span class="p">,</span> <span class="s1">&#39;reference_store&#39;</span><span class="p">,</span> <span class="s1">&#39;simulator_reset&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">validate_leaves_are_parameters</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        checks to make sure outer most leaf nodes of config are parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ACT3MultiAgentEnvEppParameters</span><span class="o">.</span><span class="n">_validate_leaves_are_parameters</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">
















  <div class="doc doc-object doc-method">



<h3 id="corl.environment.multi_agent_env.ACT3MultiAgentEnvEppParameters.validate_leaves_are_parameters" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validate_leaves_are_parameters</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvEppParameters.validate_leaves_are_parameters" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>checks to make sure outer most leaf nodes of config are parameters</p>

        <details class="quote">
          <summary>Source code in <code>corl/environment/multi_agent_env.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s1">&#39;world&#39;</span><span class="p">,</span> <span class="s1">&#39;task&#39;</span><span class="p">,</span> <span class="s1">&#39;shared&#39;</span><span class="p">,</span> <span class="s1">&#39;reference_store&#39;</span><span class="p">,</span> <span class="s1">&#39;simulator_reset&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">validate_leaves_are_parameters</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    checks to make sure outer most leaf nodes of config are parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ACT3MultiAgentEnvEppParameters</span><span class="o">.</span><span class="n">_validate_leaves_are_parameters</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h2 id="corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator" class="doc doc-heading">
        <code>
ACT3MultiAgentEnvValidator            (<span title="pydantic.main.BaseModel">BaseModel</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-model"><code>pydantic-model</code></small>
  </span>

<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator" class="headerlink" title="Permanent link">¤</a></h2>

    <div class="doc doc-contents ">

      <p>Validation model for the inputs of ACT3MultiAgentEnv</p>

        <details class="quote">
          <summary>Source code in <code>corl/environment/multi_agent_env.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ACT3MultiAgentEnvValidator</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validation model for the inputs of ACT3MultiAgentEnv&quot;&quot;&quot;</span>
    <span class="n">num_workers</span><span class="p">:</span> <span class="n">NonNegativeInt</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">worker_index</span><span class="p">:</span> <span class="n">NonNegativeInt</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">vector_index</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">NonNegativeInt</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">remote</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">deep_sanity_check</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">seed</span><span class="p">:</span> <span class="n">PositiveInt</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">horizon</span><span class="p">:</span> <span class="n">PositiveInt</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="n">sanity_check_obs</span><span class="p">:</span> <span class="n">PositiveInt</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">sensors_grid</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">]</span>
    <span class="n">plugin_paths</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Regex allows letters, numbers, underscore, dash, dot</span>
    <span class="c1"># Regex in output_path validator also allows forward slash</span>
    <span class="c1"># Empty string is not allowed</span>
    <span class="n">TrialName</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;^[\w\.-]+$&#39;</span><span class="p">)]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">output_date_string</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;^[\w\.-]+$&#39;</span><span class="p">)]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">skip_pbs_date_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># MyPy error ignored because it is handled by the pre-validator</span>
    <span class="n">output_path</span><span class="p">:</span> <span class="n">DirectoryPath</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: ignore[assignment]</span>

    <span class="n">agent_platforms</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span>
    <span class="n">agents</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">AgentParseInfo</span><span class="p">]</span>

    <span class="n">simulator</span><span class="p">:</span> <span class="n">Factory</span>
    <span class="n">platforms</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">BaseAvailablePlatformTypes</span><span class="p">]</span>
    <span class="n">other_platforms</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">reference_store</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ObjectStoreElem</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">dones</span><span class="p">:</span> <span class="n">EnvironmentDoneValidator</span> <span class="o">=</span> <span class="n">EnvironmentDoneValidator</span><span class="p">()</span>
    <span class="n">end_episode_on_first_agent_done</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">simulator_reset_parameters</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">episode_parameter_provider</span><span class="p">:</span> <span class="n">Factory</span>
    <span class="n">episode_parameter_provider_parameters</span><span class="p">:</span> <span class="n">ACT3MultiAgentEnvEppParameters</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: ignore</span>
    <span class="n">epp_registry</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">EpisodeParameterProvider</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: ignore</span>

    <span class="n">max_agent_rate</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># the maximum rate (in Hz) that an agent may be run at</span>
    <span class="n">timestep_epsilon</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-3</span>
    <span class="n">sim_warmup_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># number of times to step simulator before getting initial obs</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">epp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EpisodeParameterProvider</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return the current episode parameter provider</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">epp_registry</span><span class="p">[</span><span class="n">ACT3MultiAgentEnv</span><span class="o">.</span><span class="n">episode_parameter_provider_name</span><span class="p">]</span>  <span class="c1"># pylint: disable=unsubscriptable-object</span>

    <span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Allow arbitrary types for Parameter&quot;&quot;&quot;</span>
        <span class="n">arbitrary_types_allowed</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s1">&#39;seed&#39;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_seed</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute a valid seed&quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">seed</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">seeding</span><span class="o">.</span><span class="n">np_random</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">seed</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s1">&#39;plugin_paths&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_plugin_paths</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Use the plugin path attribute to initialize the plugin library.&quot;&quot;&quot;</span>
        <span class="n">PluginLibrary</span><span class="o">.</span><span class="n">add_paths</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s1">&#39;output_path&#39;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">create_output_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build the output path.&quot;&quot;&quot;</span>

        <span class="n">v</span> <span class="o">=</span> <span class="n">v</span> <span class="ow">or</span> <span class="s1">&#39;data/act3/ray_results&#39;</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">parse_obj_as</span><span class="p">(</span><span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;^[\w/\.-]+$&#39;</span><span class="p">)],</span> <span class="n">v</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;TrialName&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;skip_pbs_date_update&quot;</span><span class="p">]:</span>
                <span class="n">trial_prefix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">trial_prefix</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PBS_JOBID&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TRIAL_NAME_PREFIX&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">trial_prefix</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">trial_prefix</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;TrialName&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;TrialName&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;output_date_string&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;skip_pbs_date_update&quot;</span><span class="p">]:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;output_date_string&#39;</span><span class="p">])</span>

        <span class="n">v</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;worker_index&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;vector_index&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;vector_index&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">v</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s1">&#39;simulator&#39;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">resolve_simulator_plugin</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine the simulator from the plugin library.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">v</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
            <span class="c1"># Let pydantic print out an error when there is no type field</span>
            <span class="k">return</span> <span class="n">v</span>

        <span class="n">match</span> <span class="o">=</span> <span class="n">PluginLibrary</span><span class="o">.</span><span class="n">FindMatch</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">match</span><span class="p">,</span> <span class="n">BaseSimulator</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Simulator must subclass BaseSimulator, but is is of type </span><span class="si">{</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">match</span><span class="p">,</span> <span class="s1">&#39;config&#39;</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;config&#39;</span><span class="p">)}</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s1">&#39;platforms&#39;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">resolve_platforms</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine the platforms from the plugin library.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">v</span>
        <span class="k">return</span> <span class="n">PluginLibrary</span><span class="o">.</span><span class="n">FindMatch</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;simulator&#39;</span><span class="p">:</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;simulator&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">type</span><span class="p">})</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s1">&#39;agents&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">agents_not_empty</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ensure that at least one agent exists&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;No agents exist&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">agent_name</span><span class="p">,</span> <span class="n">agent</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">assert</span> <span class="n">agent</span><span class="o">.</span><span class="n">platform_name</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;agent_platforms&#39;</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;missing platform &#39;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">platform_name</span><span class="si">}</span><span class="s2">&#39; for agent &#39;</span><span class="si">{</span><span class="n">agent_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
            <span class="k">assert</span> <span class="n">agent</span><span class="o">.</span><span class="n">platform_name</span> <span class="o">==</span> <span class="n">agent_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;invalid platform name </span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">platform_name</span><span class="si">}</span><span class="s2"> for agent </span><span class="si">{</span><span class="n">agent_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="n">resolve_reference_store_factory</span> <span class="o">=</span> <span class="n">validator</span><span class="p">(</span><span class="s1">&#39;reference_store&#39;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">each_item</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">Factory</span><span class="o">.</span><span class="n">resolve_factory</span><span class="p">)</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s1">&#39;dones&#39;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">agents_match</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ensure that platform in task dones match provided platforms&quot;&quot;&quot;</span>
        <span class="c1"># No extra agents in task dones</span>
        <span class="k">for</span> <span class="n">platform</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">platform</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;agent_platforms&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Platform </span><span class="si">{</span><span class="n">platform</span><span class="si">}</span><span class="s1"> lists a done condition but is not an allowed platform&#39;</span><span class="p">)</span>

        <span class="c1"># Task dones exist for all agents.  Make empty ones if necessary</span>
        <span class="k">for</span> <span class="n">platform</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;agent_platforms&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">platform</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">task</span><span class="p">:</span>
                <span class="n">v</span><span class="o">.</span><span class="n">task</span><span class="p">[</span><span class="n">platform</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">return</span> <span class="n">v</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s1">&#39;simulator_reset_parameters&#39;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">update_units_and_parameters</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update simulation reset parameters to meet base simulator requirements.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">validation_helper_units_and_parameters</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s1">&#39;episode_parameter_provider_parameters&#39;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">build_episode_parameter_provider_parameters</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">_v</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ACT3MultiAgentEnvEppParameters</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Create the episode parameter provider for this configuration&quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;reference_store&#39;</span><span class="p">,</span> <span class="s1">&#39;dones&#39;</span><span class="p">,</span> <span class="s1">&#39;simulator_reset_parameters&#39;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">values</span>

        <span class="n">reference_parameters</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ref_name</span><span class="p">,</span> <span class="n">ref_value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;reference_store&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref_value</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">):</span>
                <span class="n">reference_parameters</span><span class="p">[</span><span class="n">ref_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref_value</span>

        <span class="n">world_parameters</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">functor</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;dones&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">world</span><span class="p">:</span>
            <span class="n">functor</span><span class="o">.</span><span class="n">add_to_parameter_store</span><span class="p">(</span><span class="n">world_parameters</span><span class="p">)</span>

        <span class="n">task_parameters</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">agent</span><span class="p">,</span> <span class="n">task_dones</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;dones&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">agent_task_parameters</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">functor</span> <span class="ow">in</span> <span class="n">task_dones</span><span class="p">:</span>
                <span class="n">functor</span><span class="o">.</span><span class="n">add_to_parameter_store</span><span class="p">(</span><span class="n">agent_task_parameters</span><span class="p">)</span>
            <span class="n">task_parameters</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span> <span class="o">=</span> <span class="n">agent_task_parameters</span>

        <span class="n">shared_parameters</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">functor</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;dones&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shared</span><span class="p">:</span>
            <span class="n">functor</span><span class="o">.</span><span class="n">add_to_parameter_store</span><span class="p">(</span><span class="n">shared_parameters</span><span class="p">)</span>

        <span class="n">sim_parameters_flat</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">name</span><span class="p">:</span> <span class="n">param</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span>
            <span class="n">param</span> <span class="ow">in</span> <span class="n">flatten_dict</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;simulator_reset_parameters&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">sim_parameters</span> <span class="o">=</span> <span class="n">flatten_dict</span><span class="o">.</span><span class="n">unflatten</span><span class="p">(</span><span class="n">sim_parameters_flat</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ACT3MultiAgentEnvEppParameters</span><span class="p">(</span>
            <span class="n">world</span><span class="o">=</span><span class="n">world_parameters</span><span class="p">,</span>
            <span class="n">task</span><span class="o">=</span><span class="n">task_parameters</span><span class="p">,</span>
            <span class="n">shared</span><span class="o">=</span><span class="n">shared_parameters</span><span class="p">,</span>
            <span class="n">reference_store</span><span class="o">=</span><span class="n">reference_parameters</span><span class="p">,</span>
            <span class="n">simulator_reset</span><span class="o">=</span><span class="n">sim_parameters</span>
        <span class="p">)</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s1">&#39;epp_registry&#39;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">construct_epp_registry_if_necessary_and_validate</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">epp_registry</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        validates the Episode Parameter provider registry</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">epp_registry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">epp_registry</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">env_epp_parameters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;episode_parameter_provider_parameters&#39;</span><span class="p">])</span>
            <span class="n">flat_env_epp_parameters</span> <span class="o">=</span> <span class="n">flatten_dict</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">env_epp_parameters</span><span class="p">)</span>
            <span class="n">env_epp</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;episode_parameter_provider&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="n">flat_env_epp_parameters</span><span class="p">)</span>
            <span class="n">epp_registry</span><span class="p">[</span><span class="n">ACT3MultiAgentEnv</span><span class="o">.</span><span class="n">episode_parameter_provider_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">env_epp</span>

            <span class="k">for</span> <span class="n">agent_id</span><span class="p">,</span> <span class="n">agent_info</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;agents&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">agent</span> <span class="o">=</span> <span class="n">agent_info</span><span class="o">.</span><span class="n">class_config</span><span class="o">.</span><span class="n">agent</span><span class="p">(</span>
                    <span class="n">agent_name</span><span class="o">=</span><span class="n">agent_id</span><span class="p">,</span> <span class="n">platform_name</span><span class="o">=</span><span class="n">agent_info</span><span class="o">.</span><span class="n">platform_name</span><span class="p">,</span> <span class="o">**</span><span class="n">agent_info</span><span class="o">.</span><span class="n">class_config</span><span class="o">.</span><span class="n">config</span>
                <span class="p">)</span>
                <span class="n">epp_registry</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">epp</span>

        <span class="k">if</span> <span class="n">ACT3MultiAgentEnv</span><span class="o">.</span><span class="n">episode_parameter_provider_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">epp_registry</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing EPP for &#39;</span><span class="si">{</span><span class="n">ACT3MultiAgentEnv</span><span class="o">.</span><span class="n">episode_parameter_provider_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">agent_id</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;agents&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">agent_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">epp_registry</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing EPP for &#39;</span><span class="si">{</span><span class="n">agent_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">epp</span> <span class="ow">in</span> <span class="n">epp_registry</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">epp</span><span class="p">,</span> <span class="n">EpisodeParameterProvider</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Invalid type for epp_registry[&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39;]: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">epp</span><span class="p">)</span><span class="si">}</span><span class="s2">, only </span><span class="si">{</span><span class="n">EpisodeParameterProvider</span><span class="o">.</span><span class="vm">__qualname__</span><span class="si">}</span><span class="s2"> allowed&quot;</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">epp_registry</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">














  <div class="doc doc-object doc-attribute">



<h3 id="corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.epp" class="doc doc-heading">
<code class="highlight language-python"><span class="n">epp</span><span class="p">:</span> <span class="n">EpisodeParameterProvider</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.epp" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>return the current episode parameter provider</p>
    </div>

  </div>

























  <div class="doc doc-object doc-class">



<h3 id="corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.Config" class="doc doc-heading">
        <code>
Config        </code>



<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.Config" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Allow arbitrary types for Parameter</p>

        <details class="quote">
          <summary>Source code in <code>corl/environment/multi_agent_env.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Allow arbitrary types for Parameter&quot;&quot;&quot;</span>
    <span class="n">arbitrary_types_allowed</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">












  </div>

    </div>

  </div>







  <div class="doc doc-object doc-method">



<h3 id="corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.add_plugin_paths" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_plugin_paths</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.add_plugin_paths" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Use the plugin path attribute to initialize the plugin library.</p>

        <details class="quote">
          <summary>Source code in <code>corl/environment/multi_agent_env.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s1">&#39;plugin_paths&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">add_plugin_paths</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Use the plugin path attribute to initialize the plugin library.&quot;&quot;&quot;</span>
    <span class="n">PluginLibrary</span><span class="o">.</span><span class="n">add_paths</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.agents_match" class="doc doc-heading">
<code class="highlight language-python"><span class="n">agents_match</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.agents_match" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Ensure that platform in task dones match provided platforms</p>

        <details class="quote">
          <summary>Source code in <code>corl/environment/multi_agent_env.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s1">&#39;dones&#39;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">agents_match</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Ensure that platform in task dones match provided platforms&quot;&quot;&quot;</span>
    <span class="c1"># No extra agents in task dones</span>
    <span class="k">for</span> <span class="n">platform</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">platform</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;agent_platforms&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Platform </span><span class="si">{</span><span class="n">platform</span><span class="si">}</span><span class="s1"> lists a done condition but is not an allowed platform&#39;</span><span class="p">)</span>

    <span class="c1"># Task dones exist for all agents.  Make empty ones if necessary</span>
    <span class="k">for</span> <span class="n">platform</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;agent_platforms&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">platform</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">task</span><span class="p">:</span>
            <span class="n">v</span><span class="o">.</span><span class="n">task</span><span class="p">[</span><span class="n">platform</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">return</span> <span class="n">v</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.agents_not_empty" class="doc doc-heading">
<code class="highlight language-python"><span class="n">agents_not_empty</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.agents_not_empty" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Ensure that at least one agent exists</p>

        <details class="quote">
          <summary>Source code in <code>corl/environment/multi_agent_env.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s1">&#39;agents&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">agents_not_empty</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Ensure that at least one agent exists&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;No agents exist&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">agent_name</span><span class="p">,</span> <span class="n">agent</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">assert</span> <span class="n">agent</span><span class="o">.</span><span class="n">platform_name</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;agent_platforms&#39;</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;missing platform &#39;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">platform_name</span><span class="si">}</span><span class="s2">&#39; for agent &#39;</span><span class="si">{</span><span class="n">agent_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="k">assert</span> <span class="n">agent</span><span class="o">.</span><span class="n">platform_name</span> <span class="o">==</span> <span class="n">agent_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;invalid platform name </span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">platform_name</span><span class="si">}</span><span class="s2"> for agent </span><span class="si">{</span><span class="n">agent_name</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">v</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.build_episode_parameter_provider_parameters" class="doc doc-heading">
<code class="highlight language-python"><span class="n">build_episode_parameter_provider_parameters</span><span class="p">(</span><span class="n">_v</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.build_episode_parameter_provider_parameters" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Create the episode parameter provider for this configuration</p>

        <details class="quote">
          <summary>Source code in <code>corl/environment/multi_agent_env.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s1">&#39;episode_parameter_provider_parameters&#39;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">build_episode_parameter_provider_parameters</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">_v</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ACT3MultiAgentEnvEppParameters</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Create the episode parameter provider for this configuration&quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;reference_store&#39;</span><span class="p">,</span> <span class="s1">&#39;dones&#39;</span><span class="p">,</span> <span class="s1">&#39;simulator_reset_parameters&#39;</span><span class="p">]:</span>
        <span class="k">assert</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">values</span>

    <span class="n">reference_parameters</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">ref_name</span><span class="p">,</span> <span class="n">ref_value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;reference_store&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref_value</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">):</span>
            <span class="n">reference_parameters</span><span class="p">[</span><span class="n">ref_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref_value</span>

    <span class="n">world_parameters</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">functor</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;dones&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">world</span><span class="p">:</span>
        <span class="n">functor</span><span class="o">.</span><span class="n">add_to_parameter_store</span><span class="p">(</span><span class="n">world_parameters</span><span class="p">)</span>

    <span class="n">task_parameters</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">agent</span><span class="p">,</span> <span class="n">task_dones</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;dones&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">agent_task_parameters</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">functor</span> <span class="ow">in</span> <span class="n">task_dones</span><span class="p">:</span>
            <span class="n">functor</span><span class="o">.</span><span class="n">add_to_parameter_store</span><span class="p">(</span><span class="n">agent_task_parameters</span><span class="p">)</span>
        <span class="n">task_parameters</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span> <span class="o">=</span> <span class="n">agent_task_parameters</span>

    <span class="n">shared_parameters</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">functor</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;dones&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shared</span><span class="p">:</span>
        <span class="n">functor</span><span class="o">.</span><span class="n">add_to_parameter_store</span><span class="p">(</span><span class="n">shared_parameters</span><span class="p">)</span>

    <span class="n">sim_parameters_flat</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">param</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span>
        <span class="n">param</span> <span class="ow">in</span> <span class="n">flatten_dict</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;simulator_reset_parameters&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">sim_parameters</span> <span class="o">=</span> <span class="n">flatten_dict</span><span class="o">.</span><span class="n">unflatten</span><span class="p">(</span><span class="n">sim_parameters_flat</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ACT3MultiAgentEnvEppParameters</span><span class="p">(</span>
        <span class="n">world</span><span class="o">=</span><span class="n">world_parameters</span><span class="p">,</span>
        <span class="n">task</span><span class="o">=</span><span class="n">task_parameters</span><span class="p">,</span>
        <span class="n">shared</span><span class="o">=</span><span class="n">shared_parameters</span><span class="p">,</span>
        <span class="n">reference_store</span><span class="o">=</span><span class="n">reference_parameters</span><span class="p">,</span>
        <span class="n">simulator_reset</span><span class="o">=</span><span class="n">sim_parameters</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.construct_epp_registry_if_necessary_and_validate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">construct_epp_registry_if_necessary_and_validate</span><span class="p">(</span><span class="n">epp_registry</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.construct_epp_registry_if_necessary_and_validate" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>validates the Episode Parameter provider registry</p>

        <details class="quote">
          <summary>Source code in <code>corl/environment/multi_agent_env.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s1">&#39;epp_registry&#39;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">construct_epp_registry_if_necessary_and_validate</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">epp_registry</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    validates the Episode Parameter provider registry</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">epp_registry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">epp_registry</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">env_epp_parameters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;episode_parameter_provider_parameters&#39;</span><span class="p">])</span>
        <span class="n">flat_env_epp_parameters</span> <span class="o">=</span> <span class="n">flatten_dict</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">env_epp_parameters</span><span class="p">)</span>
        <span class="n">env_epp</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;episode_parameter_provider&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="n">flat_env_epp_parameters</span><span class="p">)</span>
        <span class="n">epp_registry</span><span class="p">[</span><span class="n">ACT3MultiAgentEnv</span><span class="o">.</span><span class="n">episode_parameter_provider_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">env_epp</span>

        <span class="k">for</span> <span class="n">agent_id</span><span class="p">,</span> <span class="n">agent_info</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;agents&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">agent</span> <span class="o">=</span> <span class="n">agent_info</span><span class="o">.</span><span class="n">class_config</span><span class="o">.</span><span class="n">agent</span><span class="p">(</span>
                <span class="n">agent_name</span><span class="o">=</span><span class="n">agent_id</span><span class="p">,</span> <span class="n">platform_name</span><span class="o">=</span><span class="n">agent_info</span><span class="o">.</span><span class="n">platform_name</span><span class="p">,</span> <span class="o">**</span><span class="n">agent_info</span><span class="o">.</span><span class="n">class_config</span><span class="o">.</span><span class="n">config</span>
            <span class="p">)</span>
            <span class="n">epp_registry</span><span class="p">[</span><span class="n">agent_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">epp</span>

    <span class="k">if</span> <span class="n">ACT3MultiAgentEnv</span><span class="o">.</span><span class="n">episode_parameter_provider_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">epp_registry</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing EPP for &#39;</span><span class="si">{</span><span class="n">ACT3MultiAgentEnv</span><span class="o">.</span><span class="n">episode_parameter_provider_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">agent_id</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;agents&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">agent_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">epp_registry</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing EPP for &#39;</span><span class="si">{</span><span class="n">agent_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">epp</span> <span class="ow">in</span> <span class="n">epp_registry</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">epp</span><span class="p">,</span> <span class="n">EpisodeParameterProvider</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid type for epp_registry[&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39;]: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">epp</span><span class="p">)</span><span class="si">}</span><span class="s2">, only </span><span class="si">{</span><span class="n">EpisodeParameterProvider</span><span class="o">.</span><span class="vm">__qualname__</span><span class="si">}</span><span class="s2"> allowed&quot;</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">epp_registry</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.create_output_path" class="doc doc-heading">
<code class="highlight language-python"><span class="n">create_output_path</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.create_output_path" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Build the output path.</p>

        <details class="quote">
          <summary>Source code in <code>corl/environment/multi_agent_env.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s1">&#39;output_path&#39;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">create_output_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Build the output path.&quot;&quot;&quot;</span>

    <span class="n">v</span> <span class="o">=</span> <span class="n">v</span> <span class="ow">or</span> <span class="s1">&#39;data/act3/ray_results&#39;</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">parse_obj_as</span><span class="p">(</span><span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;^[\w/\.-]+$&#39;</span><span class="p">)],</span> <span class="n">v</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;TrialName&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;skip_pbs_date_update&quot;</span><span class="p">]:</span>
            <span class="n">trial_prefix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">trial_prefix</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PBS_JOBID&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TRIAL_NAME_PREFIX&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">trial_prefix</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">trial_prefix</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;TrialName&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;TrialName&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;output_date_string&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;skip_pbs_date_update&quot;</span><span class="p">]:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;output_date_string&#39;</span><span class="p">])</span>

    <span class="n">v</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;worker_index&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;vector_index&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;vector_index&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">v</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.get_seed" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_seed</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.get_seed" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Compute a valid seed</p>

        <details class="quote">
          <summary>Source code in <code>corl/environment/multi_agent_env.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s1">&#39;seed&#39;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_seed</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute a valid seed&quot;&quot;&quot;</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">seed</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">seeding</span><span class="o">.</span><span class="n">np_random</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">seed</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.resolve_platforms" class="doc doc-heading">
<code class="highlight language-python"><span class="n">resolve_platforms</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.resolve_platforms" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Determine the platforms from the plugin library.</p>

        <details class="quote">
          <summary>Source code in <code>corl/environment/multi_agent_env.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s1">&#39;platforms&#39;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">resolve_platforms</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Determine the platforms from the plugin library.&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">PluginLibrary</span><span class="o">.</span><span class="n">FindMatch</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;simulator&#39;</span><span class="p">:</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;simulator&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">type</span><span class="p">})</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.resolve_reference_store_factory" class="doc doc-heading">
<code class="highlight language-python"><span class="n">resolve_reference_store_factory</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.resolve_reference_store_factory" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Validator for converting a factory into the built object.</p>
<p>Usage in a pydantic model:
resolve_factory = validator('name', pre=True, allow_reuse=True)(Factory.resolve_factory)</p>

        <details class="quote">
          <summary>Source code in <code>corl/environment/multi_agent_env.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">resolve_factory</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validator for converting a factory into the built object.</span>

<span class="sd">    Usage in a pydantic model:</span>
<span class="sd">    resolve_factory = validator(&#39;name&#39;, pre=True, allow_reuse=True)(Factory.resolve_factory)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">v</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
        <span class="c1"># Not something that should be built with the factory</span>
        <span class="k">return</span> <span class="n">v</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">factory</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">factory</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.resolve_simulator_plugin" class="doc doc-heading">
<code class="highlight language-python"><span class="n">resolve_simulator_plugin</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.resolve_simulator_plugin" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Determine the simulator from the plugin library.</p>

        <details class="quote">
          <summary>Source code in <code>corl/environment/multi_agent_env.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s1">&#39;simulator&#39;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">resolve_simulator_plugin</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Determine the simulator from the plugin library.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">v</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
        <span class="c1"># Let pydantic print out an error when there is no type field</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="n">match</span> <span class="o">=</span> <span class="n">PluginLibrary</span><span class="o">.</span><span class="n">FindMatch</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span> <span class="p">{})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">match</span><span class="p">,</span> <span class="n">BaseSimulator</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Simulator must subclass BaseSimulator, but is is of type </span><span class="si">{</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">match</span><span class="p">,</span> <span class="s1">&#39;config&#39;</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;config&#39;</span><span class="p">)}</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.update_units_and_parameters" class="doc doc-heading">
<code class="highlight language-python"><span class="n">update_units_and_parameters</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#corl.environment.multi_agent_env.ACT3MultiAgentEnvValidator.update_units_and_parameters" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Update simulation reset parameters to meet base simulator requirements.</p>

        <details class="quote">
          <summary>Source code in <code>corl/environment/multi_agent_env.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s1">&#39;simulator_reset_parameters&#39;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">update_units_and_parameters</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Update simulation reset parameters to meet base simulator requirements.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">validation_helper_units_and_parameters</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h2 id="corl.environment.multi_agent_env.EnvironmentDoneValidator" class="doc doc-heading">
        <code>
EnvironmentDoneValidator            (<span title="pydantic.main.BaseModel">BaseModel</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-model"><code>pydantic-model</code></small>
  </span>

<a href="#corl.environment.multi_agent_env.EnvironmentDoneValidator" class="headerlink" title="Permanent link">¤</a></h2>

    <div class="doc doc-contents ">

      <p>Validation model for the dones of ACT3MultiAgentEnv</p>

        <details class="quote">
          <summary>Source code in <code>corl/environment/multi_agent_env.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">EnvironmentDoneValidator</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validation model for the dones of ACT3MultiAgentEnv&quot;&quot;&quot;</span>
    <span class="n">world</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">Functor</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">task</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">Functor</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">shared</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">Functor</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s1">&#39;world&#39;</span><span class="p">,</span> <span class="n">each_item</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">check_world</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if dones subclass DoneFuncBase&quot;&quot;&quot;</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">check_done</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s1">&#39;task&#39;</span><span class="p">,</span> <span class="n">each_item</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">check_task</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if dones subclass DoneFuncBase&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">check_done</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s1">&#39;shared&#39;</span><span class="p">,</span> <span class="n">each_item</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">check_shared</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if dones subclass SharedDoneFuncBase&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">functor</span><span class="p">,</span> <span class="n">SharedDoneFuncBase</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Shared Done functors must subclass SharedDoneFuncBase, but done </span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is of type </span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">functor</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">check_done</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Check if dones subclass DoneFuncBase&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">functor</span><span class="p">,</span> <span class="n">DoneFuncBase</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Done functors must subclass DoneFuncBase, but done </span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is of type </span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">functor</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">functor</span><span class="p">,</span> <span class="n">EpisodeLengthDone</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot specify EpisodeLengthDone as it is automatically added&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">














  <div class="doc doc-object doc-method">



<h3 id="corl.environment.multi_agent_env.EnvironmentDoneValidator.check_done" class="doc doc-heading">
<code class="highlight language-python"><span class="n">check_done</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#corl.environment.multi_agent_env.EnvironmentDoneValidator.check_done" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Check if dones subclass DoneFuncBase</p>

        <details class="quote">
          <summary>Source code in <code>corl/environment/multi_agent_env.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">check_done</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Check if dones subclass DoneFuncBase&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">functor</span><span class="p">,</span> <span class="n">DoneFuncBase</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Done functors must subclass DoneFuncBase, but done </span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is of type </span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">functor</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">functor</span><span class="p">,</span> <span class="n">EpisodeLengthDone</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot specify EpisodeLengthDone as it is automatically added&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="corl.environment.multi_agent_env.EnvironmentDoneValidator.check_shared" class="doc doc-heading">
<code class="highlight language-python"><span class="n">check_shared</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#corl.environment.multi_agent_env.EnvironmentDoneValidator.check_shared" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Check if dones subclass SharedDoneFuncBase</p>

        <details class="quote">
          <summary>Source code in <code>corl/environment/multi_agent_env.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s1">&#39;shared&#39;</span><span class="p">,</span> <span class="n">each_item</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">check_shared</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check if dones subclass SharedDoneFuncBase&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">functor</span><span class="p">,</span> <span class="n">SharedDoneFuncBase</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Shared Done functors must subclass SharedDoneFuncBase, but done </span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is of type </span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">functor</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="corl.environment.multi_agent_env.EnvironmentDoneValidator.check_task" class="doc doc-heading">
<code class="highlight language-python"><span class="n">check_task</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#corl.environment.multi_agent_env.EnvironmentDoneValidator.check_task" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Check if dones subclass DoneFuncBase</p>

        <details class="quote">
          <summary>Source code in <code>corl/environment/multi_agent_env.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s1">&#39;task&#39;</span><span class="p">,</span> <span class="n">each_item</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">check_task</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check if dones subclass DoneFuncBase&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">check_done</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="corl.environment.multi_agent_env.EnvironmentDoneValidator.check_world" class="doc doc-heading">
<code class="highlight language-python"><span class="n">check_world</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#corl.environment.multi_agent_env.EnvironmentDoneValidator.check_world" class="headerlink" title="Permanent link">¤</a></h3>

    <div class="doc doc-contents ">

      <p>Check if dones subclass DoneFuncBase</p>

        <details class="quote">
          <summary>Source code in <code>corl/environment/multi_agent_env.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s1">&#39;world&#39;</span><span class="p">,</span> <span class="n">each_item</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">check_world</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check if dones subclass DoneFuncBase&quot;&quot;&quot;</span>
    <span class="bp">cls</span><span class="o">.</span><span class="n">check_done</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>





                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../gym_env/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Gym env" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Gym env
            </div>
          </div>
        </a>
      
      
        
        <a href="../utils/__init__/" class="md-footer__link md-footer__link--next" aria-label="Next:   init  " rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
                init  
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://github.com/act3-ace/CoRL/" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://git.act3-ace.com/act3-rl/" target="_blank" rel="noopener" title="git.act3-ace.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="m503.5 204.6-.7-1.8-69.7-181.78c-1.4-3.57-3.9-6.59-7.2-8.64-2.4-1.55-5.1-2.515-8-2.81-2.9-.295-5.7.083-8.4 1.11-2.7 1.02-5.1 2.66-7.1 4.78-1.9 2.12-3.3 4.67-4.1 7.44l-47 144H160.8l-47.1-144c-.8-2.77-2.2-5.31-4.1-7.43-2-2.12-4.4-3.75-7.1-4.77a18.1 18.1 0 0 0-8.38-1.113 18.4 18.4 0 0 0-8.04 2.793 18.09 18.09 0 0 0-7.16 8.64L9.267 202.8l-.724 1.8a129.57 129.57 0 0 0-3.52 82c7.747 26.9 24.047 50.7 46.447 67.6l.27.2.59.4 105.97 79.5 52.6 39.7 32 24.2c3.7 1.9 8.3 4.3 13 4.3 4.7 0 9.3-2.4 13-4.3l32-24.2 52.6-39.7 106.7-79.9.3-.3c22.4-16.9 38.7-40.6 45.6-67.5 8.6-27 7.4-55.8-2.6-82z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.top"], "search": "../../../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.37e9125f.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@8.4.2/dist/mermaid.min.js"></script>
      
    
  </body>
</html>